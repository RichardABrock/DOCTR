<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>SEM – DOCTR</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../css/mastemr.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="index.qmd" class="navbar-brand navbar-brand-logo">
    <img src="../images/KCL_logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="index.qmd">
    <span class="navbar-title">DOCTR</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/06-1-SEM.html">SEM</a></li><li class="breadcrumb-item"><a href="../chapters/06-1-SEM.html">SEM</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Introduction to R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-1-Loading_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-2-Intro_tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Loading packages and exploring data</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Introduction to Stats</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-1-Descriptive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Descriptive Statistics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-2-ChisqPISA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hypothesis testing and Chi-square tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-3-T-testsPISA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T-tests</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/04-Intro_to_graphs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Making graphs</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/05-Correlation_and_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Correlation and regression</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">SEM</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/06-1-SEM.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">SEM</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A1-PISA_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PISA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A2-DfE_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DfE England</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A3-TIMSS_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TIMSS, PIRLS and ICILS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A4-Other_datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Other datasets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A5-Self_Study_Tasks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Self Study Tasks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A6-selecting_statistical_tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Selecting statistical tools</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A7-QandA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Questions and Answers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A8-Bayesian.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Statistics</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#structural-equation-modelling" id="toc-structural-equation-modelling" class="nav-link active" data-scroll-target="#structural-equation-modelling"><span class="header-section-number">1</span> Structural Equation Modelling</a>
  <ul class="collapse">
  <li><a href="#assummptions-of-sem" id="toc-assummptions-of-sem" class="nav-link" data-scroll-target="#assummptions-of-sem"><span class="header-section-number">1.1</span> Assummptions of SEM</a>
  <ul class="collapse">
  <li><a href="#a-simple-structural-model" id="toc-a-simple-structural-model" class="nav-link" data-scroll-target="#a-simple-structural-model"><span class="header-section-number">1.1.1</span> A simple structural model</a></li>
  </ul></li>
  <li><a href="#model-syntax" id="toc-model-syntax" class="nav-link" data-scroll-target="#model-syntax"><span class="header-section-number">1.2</span> Model Syntax</a>
  <ul class="collapse">
  <li><a href="#modelling-a-latent-variable" id="toc-modelling-a-latent-variable" class="nav-link" data-scroll-target="#modelling-a-latent-variable"><span class="header-section-number">1.2.1</span> Modelling a latent variable</a></li>
  </ul></li>
  <li><a href="#formatting-a-path-diagram" id="toc-formatting-a-path-diagram" class="nav-link" data-scroll-target="#formatting-a-path-diagram"><span class="header-section-number">1.3</span> Formatting a path diagram</a></li>
  <li><a href="#estimating-model-fit" id="toc-estimating-model-fit" class="nav-link" data-scroll-target="#estimating-model-fit"><span class="header-section-number">1.4</span> Estimating model fit</a></li>
  <li><a href="#improving-model-fit" id="toc-improving-model-fit" class="nav-link" data-scroll-target="#improving-model-fit"><span class="header-section-number">1.5</span> Improving model fit</a>
  <ul class="collapse">
  <li><a href="#reporting-the-measurement-model" id="toc-reporting-the-measurement-model" class="nav-link" data-scroll-target="#reporting-the-measurement-model"><span class="header-section-number">1.5.1</span> Reporting the measurement model</a></li>
  </ul></li>
  <li><a href="#seminar-activities" id="toc-seminar-activities" class="nav-link" data-scroll-target="#seminar-activities"><span class="header-section-number">1.6</span> Seminar activities</a>
  <ul class="collapse">
  <li><a href="#task-1---create-a-model-of-science-score" id="toc-task-1---create-a-model-of-science-score" class="nav-link" data-scroll-target="#task-1---create-a-model-of-science-score"><span class="header-section-number">1.6.1</span> Task 1 - create a model of science score</a></li>
  <li><a href="#task-2---create-a-model-of-science-score" id="toc-task-2---create-a-model-of-science-score" class="nav-link" data-scroll-target="#task-2---create-a-model-of-science-score"><span class="header-section-number">1.6.2</span> Task 2 - create a model of science score</a></li>
  <li><a href="#task-3---create-a-model-of-reading-score" id="toc-task-3---create-a-model-of-reading-score" class="nav-link" data-scroll-target="#task-3---create-a-model-of-reading-score"><span class="header-section-number">1.6.3</span> Task 3 - create a model of reading score</a></li>
  <li><a href="#task-4---create-a-model-of-mathematics-score" id="toc-task-4---create-a-model-of-mathematics-score" class="nav-link" data-scroll-target="#task-4---create-a-model-of-mathematics-score"><span class="header-section-number">1.6.4</span> Task 4 - create a model of mathematics score</a></li>
  <li><a href="#task-5---modelling-a-latent-variable-for-the-home-digital-environment" id="toc-task-5---modelling-a-latent-variable-for-the-home-digital-environment" class="nav-link" data-scroll-target="#task-5---modelling-a-latent-variable-for-the-home-digital-environment"><span class="header-section-number">1.6.5</span> Task 5 - Modelling a latent variable for the home digital environment</a></li>
  <li><a href="#task-6---building-a-more-complex-latent-variable-in-sem" id="toc-task-6---building-a-more-complex-latent-variable-in-sem" class="nav-link" data-scroll-target="#task-6---building-a-more-complex-latent-variable-in-sem"><span class="header-section-number">1.6.6</span> Task 6 - building a more complex latent variable in SEM</a></li>
  <li><a href="#task-7---check-the-model-you-built-in-step-6-for-goodness-of-model-fit-and-improve-it" id="toc-task-7---check-the-model-you-built-in-step-6-for-goodness-of-model-fit-and-improve-it" class="nav-link" data-scroll-target="#task-7---check-the-model-you-built-in-step-6-for-goodness-of-model-fit-and-improve-it"><span class="header-section-number">1.6.7</span> Task 7 - Check the model you built in step 6 for goodness of model fit and improve it</a></li>
  <li><a href="#task-8---report-the-factor-loadings-and-r2-for-your-model" id="toc-task-8---report-the-factor-loadings-and-r2-for-your-model" class="nav-link" data-scroll-target="#task-8---report-the-factor-loadings-and-r2-for-your-model"><span class="header-section-number">1.6.8</span> Task 8 - Report the factor loadings and R2 for your model</a></li>
  <li><a href="#task-9---create-your-own-model-of-overall-achievement-in-hong-kong-china" id="toc-task-9---create-your-own-model-of-overall-achievement-in-hong-kong-china" class="nav-link" data-scroll-target="#task-9---create-your-own-model-of-overall-achievement-in-hong-kong-china"><span class="header-section-number">1.6.9</span> Task 9 - Create your own model of overall achievement in Hong Kong (China)</a></li>
  </ul></li>
  <li><a href="#further-information" id="toc-further-information" class="nav-link" data-scroll-target="#further-information"><span class="header-section-number">1.7</span> Further information</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/06-1-SEM.html">SEM</a></li><li class="breadcrumb-item"><a href="../chapters/06-1-SEM.html">SEM</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">SEM</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="structural-equation-modelling" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Structural Equation Modelling</h1>
<p>Structural Equation Modelling (SEM) is an approach to representing the correlations between a number of variables linked to some phenomenon <span class="citation" data-cites="lomax2013introduction">(<a href="#ref-lomax2013introduction" role="doc-biblioref">Lomax 2013</a>)</span>. A dependent variable (for example, scores on some test) might be linked to a number of independent variables (for example, hours of study, teacher’s level of experience, etc.). A powerful aspect of SEM is that it can be used to construct latent variables - variables which have explanatory usefulness but can’t be measured directly - out of a number of independent variables. Variables researchers can measure are called manifest variables, for example, mathematics, science and reading scores are manifest variables. These three scores might be taken to indicate intelligence, a latent variable, which can’t be measured directly.</p>
<p>To take another case, a researcher might wish to investigate how home environment impacts students’ mathematics achievement. There is no single variable, no single score, that can be measured to represent a young person’s home environment as 7/10 or 3/10. We might then consider their home environment a latent variable. We imagine that the nature of the circumstances in their home impacts their learning, but we cannot directly report the level of the home environment as a variable.</p>
<p>SEM allows us to propose a latent variable, like home environment, and calculate the contribution of a number of variables we can measure (e.g.&nbsp;the number of books in the home, parents’ occupation and level of education, family wealth, etc.) to the latent variable.</p>
<section id="assummptions-of-sem" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="assummptions-of-sem"><span class="header-section-number">1.1</span> Assummptions of SEM</h2>
<p>SEM is based on a number of assumptions:</p>
<ol type="a">
<li>Independence - the Observations are assumed to be independent of each other</li>
<li>No Perfect Multicollinearity - the independent variables are not perfectly correlated</li>
<li>Homoscedasticity - the variance of the residuals is constant</li>
<li>No multicollinearity - the independent variables are not highly correlated <span class="citation" data-cites="hoyle2012handbook">(<a href="#ref-hoyle2012handbook" role="doc-biblioref">Hoyle 2012</a>)</span></li>
<li>Sample size - a large enough sample size to ensure the model is stable - assuming a common power level of 80% and significance levels of 0.05, and minimum path coefficient of 0.2, a sample size of 155 is required <span class="citation" data-cites="hair2021partial">(<a href="#ref-hair2021partial" role="doc-biblioref">Hair Jr et al. 2021</a>)</span></li>
</ol>
<section id="a-simple-structural-model" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="a-simple-structural-model"><span class="header-section-number">1.1.1</span> A simple structural model</h3>
<p>Researchers use SEM to determine the correlations between a number of variable in a data set. It allows the relationship between multiple variables to be taken into account.</p>
<p>For example, in the PISA data set, in the context of data related to UK students achievement in mathematics, a researcher might be interested in building a model of mathematics (<code>PV1MATH</code>) score by a number of variables in the data set, for example, reading score (<code>PV1READ</code>), science score (<code>PV1SCIE</code>), family cultural capital (the index of economic, social and cultural status: <code>ESCS</code>), wealth (<code>WEALTH</code>) and gender (<code>ST004D01T</code>). SEM can be used to represent the relationship between these variables and students’ mathematics achievement.</p>
<p>To create the SEM we will use the <code>lavaan</code> package - <code>lavaan</code> is a contraction of Latent Variable Analysis and allows us to fit a number of different SEMs to data. We will also use the <code>semPlot</code> package to visualise the results. The relationships between variables in SEMs are often represented as path diagrams - representations in which variables are represented as squares or circles and arrows labelled with correlation coefficients join the variables to represent the relationships.<code>semPlot</code> allows use to draw path diagrams.</p>
</section>
</section>
<section id="model-syntax" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="model-syntax"><span class="header-section-number">1.2</span> Model Syntax</h2>
<p>Consider the SEM introduced above - a model of the variables that impact students’ mathematics scores.</p>
<p>To create the SEM of UK mathematics achievement we first create a subset <code>data.frame</code> of UK data, <code>UKdata</code>. As <code>lavaan</code> uses numeric variables we need to convert gender (<code>ST004D01T</code>) to a numeric variable from its original form of a character variable (<code>Male</code>,<code>Female</code>,<code>NA</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-1"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-1-1"><a href="#annotated-cell-1-1"></a><span class="co"># Load lavaan to create the SEM and semPlot to draw path diagrams</span></span>
<span id="annotated-cell-1-2"><a href="#annotated-cell-1-2"></a></span>
<span id="annotated-cell-1-3"><a href="#annotated-cell-1-3"></a><span class="fu">library</span>(lavaan)</span>
<span id="annotated-cell-1-4"><a href="#annotated-cell-1-4"></a><span class="fu">library</span>(semPlot)</span>
<span id="annotated-cell-1-5"><a href="#annotated-cell-1-5"></a></span>
<span id="annotated-cell-1-6"><a href="#annotated-cell-1-6"></a><span class="co"># Create a subset of PISA data related to the UK containing the dependent variable of interest (PV1MATH) and the independent variables we are interested in</span></span>
<span id="annotated-cell-1-7"><a href="#annotated-cell-1-7"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-1-8" class="code-annotation-target"><a href="#annotated-cell-1-8"></a>UKdata <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-1-9" class="code-annotation-target"><a href="#annotated-cell-1-9"></a>  <span class="fu">select</span>(CNT, PV1SCIE, PV1MATH, PV1READ, ESCS, HOMEPOS, ST004D01T) <span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-1-10" class="code-annotation-target"><a href="#annotated-cell-1-10"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="annotated-cell-1-11"><a href="#annotated-cell-1-11"></a></span>
<span id="annotated-cell-1-12"><a href="#annotated-cell-1-12"></a><span class="co"># lavaan requires numeric variables as input, gender is a character variable in the data.frame so convert it.</span></span>
<span id="annotated-cell-1-13"><a href="#annotated-cell-1-13"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-1-14" class="code-annotation-target"><a href="#annotated-cell-1-14"></a>UKdata<span class="sc">$</span>ST004D01T <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST004D01T)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="8" data-code-annotation="1">line 1 passes the whole <code>PISA_2022</code> dataset and pipes it into the next line using <code>%&gt;%</code></span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="9" data-code-annotation="2">line 2 selects the variables of interest</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="10" data-code-annotation="3">line 3 filters for the UK</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="14" data-code-annotation="4">line 4 convert gender variables from character to numeric</span>
</dd>
</dl>
</div>
</div>
<p>The first step is to create the model. Models in <code>lavaan</code> are represented as a dependent variable <code>y</code>, linked to a number of independent variables <code>x1</code>, <code>x2</code>, <code>x3</code>, etc. The <code>~</code> symbol is the regression operator. A simple regression formula might then take the form of:</p>
<p>y ~ x1 + x2 + x3</p>
<p>To indicate a variable is a latent variable we use the <code>=~</code> operator. So to define a model in which the latent variable <code>f1</code> varies with three independent variables we would write:</p>
<p>f1 =~ x1 + x2 + x3</p>
<p>In some cases, the independent variables may correlate. For example, if we are investigating mathematics achievement (the dependent variable, <code>y</code>), by looking at the independent variables of reading (<code>x1</code>) and science score (<code>x2</code>), it may be the case that reading and science cores covary (that is changes to one impacts the other). In this case, we can specify covariance in our model by stating:</p>
<p>y ~ x1 + x2 The regression model x1 ~ x2 Indicating the covariance</p>
<p>In our case, considering UK mathematics achievement, we can set up a model that mathematics score <code>PV1MATH</code> varies with science score <code>PV1SCIE</code>, reading score <code>PV1READ</code>, cultural resources in the home <code>ESCS</code>, a wealth proxy measure, HOMEPOS and gender <code>ST004D01T</code>: <code>model &lt;- "PV1MATH ~ PV1SCIE + PV1READ + ESCS + HOMEPOS"</code></p>
<p>We then pass the model, and the <code>data.frame</code> to the <code>sem</code> function: <code>fit&lt;-sem(model, data=UKdata)</code>. This produces a model as the output <code>fit</code>. To see the results we call <code>summary(fit)</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-2"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-2-1" class="code-annotation-target"><a href="#annotated-cell-2-1"></a>model<span class="ot">&lt;-</span><span class="st">"PV1MATH ~ PV1SCIE + PV1READ + ESCS + HOMEPOS"</span></span>
<span id="annotated-cell-2-2"><a href="#annotated-cell-2-2"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-2-3" class="code-annotation-target"><a href="#annotated-cell-2-3"></a>fit<span class="ot">&lt;-</span><span class="fu">sem</span>(model, <span class="at">data =</span> UKdata)</span>
<span id="annotated-cell-2-4"><a href="#annotated-cell-2-4"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-2-5" class="code-annotation-target"><a href="#annotated-cell-2-5"></a><span class="fu">summary</span>(fit)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-2" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="1" data-code-annotation="1">line 1 specify the model - we want to model <code>PV1MATH</code> using <code>PV1SCIE</code>, <code>PV1READ</code>, <code>ESCS</code> (class proxy) and <code>HOMEPOS</code> (wealth proxy).</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="3" data-code-annotation="2">line 2 create the model using the <code>fit</code> function</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="5" data-code-annotation="3">line 3 print the model</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6-19 ended normally after 1 iteration

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                         5

                                                  Used       Total
  Number of observations                         11083       12972

Model Test User Model:
                                                      
  Test statistic                                 0.000
  Degrees of freedom                                 0

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Regressions:
                   Estimate   Std.Err  z-value  P(&gt;|z|)
  PV1MATH ~                                            
    PV1SCIE            0.565    0.007   85.604    0.000
    PV1READ            0.267    0.006   41.953    0.000
    ESCS               5.432    0.734    7.404    0.000
    HOMEPOS            1.027    0.716    1.434    0.151

Variances:
                   Estimate   Std.Err  z-value  P(&gt;|z|)
   .PV1MATH         2006.033   26.948   74.441    0.000</code></pre>
</div>
</div>
<p>In the regressions table, the function returns the value of the regression coefficients for each independent variable, and the P value (<code>P(&gt;|z|)</code>). Note in the model above all the independent variables are significant, but the largest loading comes from the <code>WEALTH</code> variable, with the science (<code>PV1SCIE</code>) and reading (<code>PV1READ</code>) scores contributing comparatively little.</p>
<p>Finally, to produce a visual representation of the model, we pass our model, <code>fit</code> to the <code>semPaths</code> function (from the <code>semPlot</code> package we loaded above). We can specify was we want displayed on the lines, in this case the estimate of the regression coefficients between the variables.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="06-1-SEM_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>In path diagrams, directly measured variables, manifest variables, are shown as squares. Latent variables are represented as circles. Single headed arrows represent the regression effects between variables. The curved arrows starting and ending on a square or circle indicate the variances of those variables. When curved arrows start and end on different variables, they represent covariance.</p>
<p>One issue to note here is the difference in the variance for the science and mathematics scores. <code>PV1SCIE</code>, <code>PV1READ</code> and <code>PV1MATH</code> are test scores and so have a large variance (the maximum and minimum science scores, for example, are 0.0 and 895.4). The variance of the two test variables is much greater that for <code>HOMEPOS</code> (Min=-10.0741 mean=-0.4447, Max=15.240) and <code>ESCS</code> (Min=-6.841 mean=-0.310, Max=7.380).</p>
<p>To resolve this difference, we can use the scale function to create a similar scale for <code>PV1SCIE</code>, <code>PV1MATH</code> and <code>PV1READ</code>. The <code>scale</code> function sets the mean of the variable to 0 and the variance to 1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-3"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-3-1" class="code-annotation-target"><a href="#annotated-cell-3-1"></a>UKdata<span class="sc">$</span>PV1READ<span class="ot">&lt;-</span><span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1READ)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-3-2" class="code-annotation-target"><a href="#annotated-cell-3-2"></a>UKdata<span class="sc">$</span>PV1MATH<span class="ot">&lt;-</span><span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1MATH)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-3-3" class="code-annotation-target"><a href="#annotated-cell-3-3"></a>UKdata<span class="sc">$</span>PV1SCIE<span class="ot">&lt;-</span><span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1SCIE)</span>
<span id="annotated-cell-3-4"><a href="#annotated-cell-3-4"></a></span>
<span id="annotated-cell-3-5"><a href="#annotated-cell-3-5"></a>fit<span class="ot">&lt;-</span><span class="fu">sem</span>(model, <span class="at">data=</span>UKdata)</span>
<span id="annotated-cell-3-6"><a href="#annotated-cell-3-6"></a><span class="fu">summary</span>(fit)</span>
<span id="annotated-cell-3-7"><a href="#annotated-cell-3-7"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-3" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="1" data-code-annotation="1">line 1 normalise the reading scores about a mean of 0 with a variance of 1</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="2" data-code-annotation="2">line 2 normalise maths scores</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="3" data-code-annotation="3">line 3 normalise science scores</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="06-1-SEM_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6-19 ended normally after 1 iteration

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                         5

                                                  Used       Total
  Number of observations                         11083       12972

Model Test User Model:
                                                      
  Test statistic                                 0.000
  Degrees of freedom                                 0

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Regressions:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  PV1MATH ~                                           
    PV1SCIE           0.607    0.007   85.604    0.000
    PV1READ           0.295    0.007   41.953    0.000
    ESCS              0.057    0.008    7.404    0.000
    HOMEPOS           0.011    0.008    1.434    0.151

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .PV1MATH           0.222    0.003   74.441    0.000</code></pre>
</div>
</div>
<p>Scaling the test scores gives a more balanced model.</p>
<p>We can make the model more complex, by adding that two of our independent variables, reading (<code>PV1READ</code>) and science (<code>PV1SCIE</code>) scores may co-vary, and vary with other independent variables. That is there is a relationship between science and reading scores. The covariance is indicated by the <code>~~</code> operator.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-4"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-4-1" class="code-annotation-target"><a href="#annotated-cell-4-1"></a>model<span class="ot">&lt;-</span><span class="st">"PV1MATH ~ PV1SCIE + PV1READ + ESCS + HOMEPOS</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-4-2" class="code-annotation-target"><a href="#annotated-cell-4-2"></a><span class="st">        PV1READ ~~ PV1SCIE</span></span>
<span id="annotated-cell-4-3"><a href="#annotated-cell-4-3"></a><span class="st">        PV1READ ~ PV1SCIE + PV1MATH + ESCS + HOMEPOS</span></span>
<span id="annotated-cell-4-4"><a href="#annotated-cell-4-4"></a><span class="st">        PV1SCIE ~ PV1READ + PV1MATH + ESCS + HOMEPOS"</span></span>
<span id="annotated-cell-4-5"><a href="#annotated-cell-4-5"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-4-6" class="code-annotation-target"><a href="#annotated-cell-4-6"></a>fit<span class="ot">&lt;-</span><span class="fu">sem</span>(model, <span class="at">data =</span> UKdata)</span>
<span id="annotated-cell-4-7"><a href="#annotated-cell-4-7"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-4-8" class="code-annotation-target"><a href="#annotated-cell-4-8"></a><span class="fu">summary</span>(fit)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-4-9" class="code-annotation-target"><a href="#annotated-cell-4-9"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-4" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="1" data-code-annotation="1">line 1 specify the model - recall <code>~</code> is the regression operator linking dependent and independent variable and <code>~~</code> indicates two variables covary.</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="2" data-code-annotation="2">line 2 specify that reading and science scores covary using <code>~~</code></span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="6" data-code-annotation="3">line 5 create the model using the <code>fit</code> function</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="8" data-code-annotation="4">line 6 print the model</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="9" data-code-annotation="5">line 7 use <code>semPath</code> to visualise the model, specifuing that we want the coefficients printed on the lines <code>whatLabels = "Estimate"</code></span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="06-1-SEM_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6-19 ended normally after 23 iterations

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                        16

                                                  Used       Total
  Number of observations                         11083       12972

Model Test User Model:
                                                      
  Test statistic                                    NA
  Degrees of freedom                                -4
  P-value (Unknown)                                 NA

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Regressions:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  PV1MATH ~                                           
    PV1SCIE           0.454       NA                  
    PV1READ           0.171       NA                  
    ESCS              0.113       NA                  
    HOMEPOS           0.071       NA                  
  PV1READ ~                                           
    PV1SCIE           0.242       NA                  
    PV1MATH           0.386       NA                  
 [ reached getOption("max.print") -- omitted 7 rows ]

Covariances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
 .PV1READ ~~                                          
   .PV1SCIE           0.065       NA                  

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .PV1MATH           0.282       NA                  
   .PV1READ           0.383       NA                  
   .PV1SCIE           0.340       NA                  </code></pre>
</div>
</div>
<section id="modelling-a-latent-variable" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="modelling-a-latent-variable"><span class="header-section-number">1.2.1</span> Modelling a latent variable</h3>
<p>As introduced above, we can use SEM to model a latent variable. For example, we might assume that students have some underlying variable linked to their general intelligence. However, in the PISA data set, we have no variable that directly measures students general intelligence. We do have data on their achievement in science (<code>PV1SCIE</code>), mathematics (<code>PV1MATH</code>) and reading (<code>PV1READ</code>) and we might assume that as the latent variable of general achievement increases so does achievement in science, mathematics and reading.</p>
<p>To perform the analysis, we use the <code>=~</code> operator in our model, which indicates a latent variable. This time, our model then sets out that we are interested in a <code>lv</code> (latent variable) which varies with science (<code>PV1SCIE</code>), mathematics (<code>PV1MATH</code>) and reading (<code>PV1READ</code>) scores:</p>
<p>model&lt;-“lv =~ PV1SCIE + PV1READ + PV1MATH”</p>
<p>Then we run the model using <code>sem</code> in the same way as above, and plot the model using <code>semPaths</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># For a latent variable</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co"># =~ means a latent variable</span></span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a>model<span class="ot">&lt;-</span><span class="st">"lv =~ PV1SCIE + PV1READ + PV1MATH"</span></span>
<span id="cb4-5"><a href="#cb4-5"></a></span>
<span id="cb4-6"><a href="#cb4-6"></a>fit<span class="ot">&lt;-</span><span class="fu">sem</span>(model, <span class="at">data =</span> UKdata)</span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6-19 ended normally after 18 iterations

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                         6

  Number of observations                         12972

Model Test User Model:
                                                      
  Test statistic                                 0.000
  Degrees of freedom                                 0

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Latent Variables:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  lv =~                                               
    PV1SCIE           1.000                           
    PV1READ           0.919    0.006  143.596    0.000
    PV1MATH           1.015    0.006  175.355    0.000

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .PV1SCIE           0.145    0.003   43.323    0.000
   .PV1READ           0.278    0.004   66.360    0.000
   .PV1MATH           0.119    0.003   36.723    0.000
    lv                0.855    0.013   67.872    0.000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="06-1-SEM_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>We can develop a more complex latent variable model. Let us assume that UK students’ reading scores depend on two latent variables, home environment (<code>lvh</code>, e.g.&nbsp;number of books, parental level of education etc.) and cognitive ability (<code>lvc</code>, e.g.&nbsp;as reported by science and mathematics scores). Here are some relevant variables:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 79%">
</colgroup>
<thead>
<tr class="header">
<th>Item name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ST005Q01JA</td>
<td>What is the <highest level="" of="" schooling=""> completed by your mother?</highest></td>
</tr>
<tr class="even">
<td>ST007Q01JA</td>
<td>What is the <highest level="" of="" schooling=""> completed by your father?</highest></td>
</tr>
<tr class="odd">
<td>ST256Q02JA</td>
<td>In your home: Classic literature (e.g.&nbsp;<shakespeare>)</shakespeare></td>
</tr>
<tr class="even">
<td>ST255Q01JA</td>
<td>How many books are there in your home?</td>
</tr>
<tr class="odd">
<td>HOMEPOS</td>
<td>Family Wealth</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-7"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-7-1"><a href="#annotated-cell-7-1"></a><span class="co"># Create a UK data frame with plausible values</span></span>
<span id="annotated-cell-7-2"><a href="#annotated-cell-7-2"></a>UKdata<span class="ot">&lt;-</span>PISA_2022<span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-7-3" class="code-annotation-target"><a href="#annotated-cell-7-3"></a>  <span class="fu">select</span>(CNT, ESCS, HOMEPOS, ST007Q01JA, ST256Q02JA, ST255Q01JA,</span>
<span id="annotated-cell-7-4"><a href="#annotated-cell-7-4"></a>         PV1READ, PV1SCIE, PV1MATH)<span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-7-5" class="code-annotation-target"><a href="#annotated-cell-7-5"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="annotated-cell-7-6"><a href="#annotated-cell-7-6"></a></span>
<span id="annotated-cell-7-7"><a href="#annotated-cell-7-7"></a><span class="co"># Make variable numeric for lavan</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-7-8" class="code-annotation-target"><a href="#annotated-cell-7-8"></a>UKdata<span class="sc">$</span>ST007Q01JA <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST007Q01JA)</span>
<span id="annotated-cell-7-9"><a href="#annotated-cell-7-9"></a>UKdata<span class="sc">$</span>ST256Q02JA <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST256Q02JA)</span>
<span id="annotated-cell-7-10"><a href="#annotated-cell-7-10"></a>UKdata<span class="sc">$</span>ST255Q01JA <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST255Q01JA)</span>
<span id="annotated-cell-7-11"><a href="#annotated-cell-7-11"></a></span>
<span id="annotated-cell-7-12"><a href="#annotated-cell-7-12"></a></span>
<span id="annotated-cell-7-13"><a href="#annotated-cell-7-13"></a><span class="co"># Scale the test scores</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-7-14" class="code-annotation-target"><a href="#annotated-cell-7-14"></a>UKdata<span class="sc">$</span>PV1READ <span class="ot">&lt;-</span> <span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1READ)</span>
<span id="annotated-cell-7-15"><a href="#annotated-cell-7-15"></a>UKdata<span class="sc">$</span>PV1MATH <span class="ot">&lt;-</span> <span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1MATH)</span>
<span id="annotated-cell-7-16"><a href="#annotated-cell-7-16"></a>UKdata<span class="sc">$</span>PV1SCIE <span class="ot">&lt;-</span> <span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1SCIE)</span>
<span id="annotated-cell-7-17"><a href="#annotated-cell-7-17"></a></span>
<span id="annotated-cell-7-18"><a href="#annotated-cell-7-18"></a><span class="co"># Propose a model with two latent variables - one related to home (lvh), the other cognitive ability (lvc)</span></span>
<span id="annotated-cell-7-19"><a href="#annotated-cell-7-19"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-7-20" class="code-annotation-target"><a href="#annotated-cell-7-20"></a>model<span class="ot">&lt;-</span><span class="st">"lvh =~ ESCS + HOMEPOS + ST007Q01JA + ST256Q02JA + ST255Q01JA</span></span>
<span id="annotated-cell-7-21"><a href="#annotated-cell-7-21"></a><span class="st">        lvc =~ PV1MATH + PV1READ</span></span>
<span id="annotated-cell-7-22"><a href="#annotated-cell-7-22"></a><span class="st">        PV1SCIE ~ lvh + lvc"</span></span>
<span id="annotated-cell-7-23"><a href="#annotated-cell-7-23"></a><span class="co"># Fit the model</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-7-24" class="code-annotation-target"><a href="#annotated-cell-7-24"></a>fit<span class="ot">&lt;-</span><span class="fu">sem</span>(model, <span class="at">data =</span> UKdata)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="7" onclick="event.preventDefault();">7</a><span id="annotated-cell-7-25" class="code-annotation-target"><a href="#annotated-cell-7-25"></a><span class="fu">summary</span>(fit)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="8" onclick="event.preventDefault();">8</a><span id="annotated-cell-7-26" class="code-annotation-target"><a href="#annotated-cell-7-26"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-7" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="3" data-code-annotation="1">line 1 create the data frame for modelling, select variables of interest</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="5" data-code-annotation="2">line 4 filter for the UK</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="8" data-code-annotation="3">line 5 convert categorical items to numeric</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="14" data-code-annotation="4">line 8 scale the variables to normalise all around a mean of 0 and variance 1</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="20" data-code-annotation="5">line 11 specify the model - note that two latent variables are proposed (lvh, lvc) - these are specified using the <code>=~</code> operator</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="24" data-code-annotation="6">line 12 create the model using the <code>fit</code> function</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="25" data-code-annotation="7">line 3 print the model</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="26" data-code-annotation="8">line 4 use <code>semPath</code> to visualise the model, specifying that we want the coefficients printed on the lines <code>whatLabels = "Estimate"</code></span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="06-1-SEM_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6-19 ended normally after 32 iterations

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                        18

                                                  Used       Total
  Number of observations                          9156       12972

Model Test User Model:
                                                      
  Test statistic                              1743.454
  Degrees of freedom                                18
  P-value (Chi-square)                           0.000

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Latent Variables:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  lvh =~                                              
    ESCS              1.000                           
    HOMEPOS           1.133    0.012   91.099    0.000
    ST007Q01JA       -0.435    0.012  -37.662    0.000
    ST256Q02JA        0.947    0.020   46.529    0.000
    ST255Q01JA        1.381    0.019   72.078    0.000
  lvc =~                                              
    PV1MATH           1.000                           
 [ reached getOption("max.print") -- omitted 1 row ]

Regressions:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  PV1SCIE ~                                           
    lvh               0.012    0.009    1.326    0.185
    lvc               0.991    0.008  121.309    0.000

Covariances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  lvh ~~                                              
    lvc               0.282    0.008   33.407    0.000

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .ESCS              0.239    0.005   46.204    0.000
   .HOMEPOS           0.148    0.005   28.609    0.000
   .ST007Q01JA        0.495    0.007   66.043    0.000
   .ST256Q02JA        1.448    0.022   65.016    0.000
   .ST255Q01JA        0.963    0.016   58.664    0.000
   .PV1MATH           0.122    0.004   30.114    0.000
   .PV1READ           0.293    0.005   56.485    0.000
   .PV1SCIE           0.155    0.004   36.360    0.000
 [ reached getOption("max.print") -- omitted 2 rows ]</code></pre>
</div>
</div>
<p>Interesting features to note are a) the much higher loading of the cognitive latent variable (lvc has a loading of 0.99) than the home environment (<code>lvh</code>, loading 0.01); b) the roughly equal contribution of mathematics and reading scores to <code>lvb</code> (the cognitive ability latent variable); c) and interesting to note the negative loadings of father’s education (ST007Q01JA - truncated to ST0) on the home environment latent variable.</p>
<p>Note the dotted line from the ESCS variable (truncated here to ESC) indicates that ESCS is acting as a marker variable, that is, it is fixed at 1.0, and the other variables determined relative to it. The same is true for <code>PV1MATH</code> for the ability latent variable.</p>
</section>
</section>
<section id="formatting-a-path-diagram" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="formatting-a-path-diagram"><span class="header-section-number">1.3</span> Formatting a path diagram</h2>
<p>There are a number of formatting options in the <code>semPaths</code> function.</p>
<p>Starting from this plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="06-1-SEM_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>To rotate the plot (<code>rotation=2</code>):</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>, <span class="at">rotation=</span><span class="dv">2</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="06-1-SEM_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>To change the colour of the lines (<code>edge.color="blue"</code>) and the size of the nodes (<code>sizeMan=8</code>):</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>, <span class="at">rotation =</span> <span class="dv">2</span>, </span>
<span id="cb10-2"><a href="#cb10-2"></a>         <span class="at">edge.color =</span> <span class="st">"blue"</span>, <span class="at">sizeMan =</span> <span class="dv">8</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="06-1-SEM_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>To link the thickness of lines to their value (<code>"std"</code>):</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>, <span class="at">rotation =</span> <span class="dv">2</span>, </span>
<span id="cb11-2"><a href="#cb11-2"></a>         <span class="at">edge.color =</span> <span class="st">"blue"</span>, </span>
<span id="cb11-3"><a href="#cb11-3"></a>         <span class="at">sizeMan =</span> <span class="dv">5</span>, <span class="st">"std"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="06-1-SEM_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>To make the labels larger (<code>edge.label.cex = 0.8</code>):</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>, <span class="at">rotation =</span> <span class="dv">2</span>, </span>
<span id="cb12-2"><a href="#cb12-2"></a>         <span class="at">edge.color =</span> <span class="st">"blue"</span>, </span>
<span id="cb12-3"><a href="#cb12-3"></a>         <span class="at">sizeMan =</span> <span class="dv">5</span>, <span class="st">"std"</span>, <span class="at">edge.label.cex =</span> <span class="fl">0.8</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="06-1-SEM_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>To change the text size in the nodes (<code>label.cex = 0.8</code>):</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>, <span class="at">rotation =</span> <span class="dv">2</span>, </span>
<span id="cb13-2"><a href="#cb13-2"></a>         <span class="at">edge.color =</span> <span class="st">"blue"</span>, </span>
<span id="cb13-3"><a href="#cb13-3"></a>         <span class="at">sizeMan =</span> <span class="dv">5</span>, <span class="st">"std"</span>, <span class="at">edge.label.cex =</span> <span class="fl">0.8</span>,</span>
<span id="cb13-4"><a href="#cb13-4"></a>         <span class="at">label.cex =</span> <span class="fl">0.8</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="06-1-SEM_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>To add a title (<code>title("PISA path diagram")</code>):</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>, <span class="at">rotation =</span> <span class="dv">2</span>, </span>
<span id="cb14-2"><a href="#cb14-2"></a>         <span class="at">edge.color =</span> <span class="st">"blue"</span>, <span class="at">sizeMan =</span> <span class="dv">5</span>, <span class="st">"std"</span>, </span>
<span id="cb14-3"><a href="#cb14-3"></a>         <span class="at">edge.label.cex =</span> <span class="fl">0.8</span>) </span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="fu">title</span>(<span class="st">"PISA path diagram"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="06-1-SEM_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>To give longer node names (<code>nodeNames=nodenames</code>), and you can increase the abbreviation of labels to a set number of characters in the nodes using <code>nCharNodes = 3</code>:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>nodenames<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Economic, social and cultural status"</span>,</span>
<span id="cb15-2"><a href="#cb15-2"></a>             <span class="st">"Wealth"</span>,<span class="st">"Maternal Schooling"</span>,<span class="st">"Paternal Schooling"</span>,</span>
<span id="cb15-3"><a href="#cb15-3"></a>             <span class="st">"In home: classical literature"</span>,<span class="st">"Books in home"</span>,</span>
<span id="cb15-4"><a href="#cb15-4"></a>             <span class="st">"Math score"</span>, <span class="st">"Reading score"</span>, <span class="st">"Science Score"</span>)</span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>, <span class="at">rotation=</span><span class="dv">2</span>, <span class="at">edge.color =</span> <span class="st">"blue"</span>, </span>
<span id="cb15-6"><a href="#cb15-6"></a>         <span class="at">sizeMan =</span><span class="dv">5</span>, <span class="st">"std"</span>, <span class="at">edge.label.cex =</span> <span class="fl">0.8</span>, <span class="at">nodeNames =</span> nodenames,</span>
<span id="cb15-7"><a href="#cb15-7"></a>         <span class="at">nCharNodes =</span> <span class="dv">5</span>)</span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="fu">title</span>(<span class="st">"PISA path diagram"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="06-1-SEM_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can find more information on formatting path diagrams using <code>semPaths</code> on <a href="https://sfcheung.github.io/semptools/articles/semptools.html">semptools</a> and on the Comprehensive R Archive network (CRAN) <a href="https://www.rdocumentation.org/packages/semPlot/versions/1.1.6/topics/semPaths">documentation</a> for the package.</p>
</div>
</div>
</section>
<section id="estimating-model-fit" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="estimating-model-fit"><span class="header-section-number">1.4</span> Estimating model fit</h2>
<p>After running a SEM, it is important to determine how well the model fits the data. There are a number of different measures of model fit, no one measure provides a definitive measure of the fit - it is best practice to consider a number of different indicators and come to a holistic judgement. Measures include:</p>
<blockquote class="blockquote">
<p><strong>The Chi-Square Test of Model Fit </strong> Assume the null hypothesis that the model fits the data well. A non-significant p-value indicates good fit. However, this test is sensitive to sample size, and with large samples, even minor deviations may be significant.</p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Comparative Fit Index (CFI) and Tucker-Lewis Index (TLI)</strong> Values closer to 1 indicate better fit. Common thresholds for the two indicies are Acceptable fit: &gt; 0.90 Good fit: &gt; 0.95</p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Root Mean Square Error of Approximation (RMSEA)</strong> A measure of approximate fit in the population. Common thresholds: Good fit: &lt; 0.06 Acceptable fit: &lt; 0.08 Look at the 90% confidence interval for RMSEA as well.</p>
</blockquote>
<p>To get estimates of model fit, when you run the summary command, include: <code>summary(fit, fit.measures = TRUE)</code></p>
<p>For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-16"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-16-1"><a href="#annotated-cell-16-1"></a><span class="co"># Create a UK data frame with plausible values</span></span>
<span id="annotated-cell-16-2"><a href="#annotated-cell-16-2"></a>UKdata<span class="ot">&lt;-</span>PISA_2022 <span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-16" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-16-3" class="code-annotation-target"><a href="#annotated-cell-16-3"></a>  <span class="fu">select</span>(CNT, ESCS, HOMEPOS, ST007Q01JA, ST256Q02JA, ST255Q01JA,</span>
<span id="annotated-cell-16-4"><a href="#annotated-cell-16-4"></a>         PV1READ, PV1SCIE, PV1MATH)<span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-16" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-16-5" class="code-annotation-target"><a href="#annotated-cell-16-5"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="annotated-cell-16-6"><a href="#annotated-cell-16-6"></a></span>
<span id="annotated-cell-16-7"><a href="#annotated-cell-16-7"></a><span class="co"># Make variable numeric for lavan</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-16" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-16-8" class="code-annotation-target"><a href="#annotated-cell-16-8"></a>UKdata<span class="sc">$</span>ST007Q01JA <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST007Q01JA)</span>
<span id="annotated-cell-16-9"><a href="#annotated-cell-16-9"></a>UKdata<span class="sc">$</span>ST256Q02JA <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST256Q02JA)</span>
<span id="annotated-cell-16-10"><a href="#annotated-cell-16-10"></a>UKdata<span class="sc">$</span>ST255Q01JA <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST255Q01JA)</span>
<span id="annotated-cell-16-11"><a href="#annotated-cell-16-11"></a></span>
<span id="annotated-cell-16-12"><a href="#annotated-cell-16-12"></a></span>
<span id="annotated-cell-16-13"><a href="#annotated-cell-16-13"></a><span class="co"># Scale the test scores</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-16" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-16-14" class="code-annotation-target"><a href="#annotated-cell-16-14"></a>UKdata<span class="sc">$</span>PV1READ <span class="ot">&lt;-</span> <span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1READ)</span>
<span id="annotated-cell-16-15"><a href="#annotated-cell-16-15"></a>UKdata<span class="sc">$</span>PV1MATH <span class="ot">&lt;-</span> <span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1MATH)</span>
<span id="annotated-cell-16-16"><a href="#annotated-cell-16-16"></a>UKdata<span class="sc">$</span>PV1SCIE <span class="ot">&lt;-</span> <span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1SCIE)</span>
<span id="annotated-cell-16-17"><a href="#annotated-cell-16-17"></a></span>
<span id="annotated-cell-16-18"><a href="#annotated-cell-16-18"></a><span class="co"># Propose a model with two latent variables - one related to home (lvh), the other cognitive ability (lvc)</span></span>
<span id="annotated-cell-16-19"><a href="#annotated-cell-16-19"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-16" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-16-20" class="code-annotation-target"><a href="#annotated-cell-16-20"></a>model<span class="ot">&lt;-</span><span class="st">"lvh =~ ESCS + HOMEPOS + ST007Q01JA + ST256Q02JA + ST255Q01JA</span></span>
<span id="annotated-cell-16-21"><a href="#annotated-cell-16-21"></a><span class="st">        lvc =~ PV1MATH + PV1READ</span></span>
<span id="annotated-cell-16-22"><a href="#annotated-cell-16-22"></a><span class="st">        PV1SCIE ~ lvh + lvc"</span></span>
<span id="annotated-cell-16-23"><a href="#annotated-cell-16-23"></a><span class="co"># Fit the model</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-16" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-16-24" class="code-annotation-target"><a href="#annotated-cell-16-24"></a>fit<span class="ot">&lt;-</span><span class="fu">sem</span>(model, <span class="at">data =</span> UKdata)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-16" data-target-annotation="7" onclick="event.preventDefault();">7</a><span id="annotated-cell-16-25" class="code-annotation-target"><a href="#annotated-cell-16-25"></a><span class="fu">summary</span>(fit, , <span class="at">fit.measures =</span> <span class="cn">TRUE</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-16" data-target-annotation="8" onclick="event.preventDefault();">8</a><span id="annotated-cell-16-26" class="code-annotation-target"><a href="#annotated-cell-16-26"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-16" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-16" data-code-lines="3" data-code-annotation="1">line 1 create the data frame for modelling, select variables of interest</span>
</dd>
<dt data-target-cell="annotated-cell-16" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-16" data-code-lines="5" data-code-annotation="2">line 4 filter for the UK</span>
</dd>
<dt data-target-cell="annotated-cell-16" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-16" data-code-lines="8" data-code-annotation="3">line 5 convert categorical items to numeric</span>
</dd>
<dt data-target-cell="annotated-cell-16" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-16" data-code-lines="14" data-code-annotation="4">line 8 scale the variables to normalise all around a mean of 0 and variance 1</span>
</dd>
<dt data-target-cell="annotated-cell-16" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-16" data-code-lines="20" data-code-annotation="5">line 11 specify the model - note that two latent variables are proposed (lvh, lvc) - these are specified using the <code>=~</code> operator</span>
</dd>
<dt data-target-cell="annotated-cell-16" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-16" data-code-lines="24" data-code-annotation="6">line 12 create the model using the <code>fit</code> function</span>
</dd>
<dt data-target-cell="annotated-cell-16" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-16" data-code-lines="25" data-code-annotation="7">line 3 print the model - <strong><em><code>fit.measures = TRUE</code> reports the fit parameters</em></strong></span>
</dd>
<dt data-target-cell="annotated-cell-16" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-16" data-code-lines="26" data-code-annotation="8">line 4 use <code>semPath</code> to visualise the model, specifying that we want the coefficients printed on the lines <code>whatLabels = "Estimate"</code></span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="06-1-SEM_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6-19 ended normally after 32 iterations

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                        18

                                                  Used       Total
  Number of observations                          9156       12972

Model Test User Model:
                                                      
  Test statistic                              1743.454
  Degrees of freedom                                18
  P-value (Chi-square)                           0.000

Model Test Baseline Model:

  Test statistic                             40961.751
  Degrees of freedom                                28
  P-value                                        0.000

User Model versus Baseline Model:

  Comparative Fit Index (CFI)                    0.958
  Tucker-Lewis Index (TLI)                       0.934

Loglikelihood and Information Criteria:

  Loglikelihood user model (H0)             -84967.578
  Loglikelihood unrestricted model (H1)     -84095.851
                                                      
  Akaike (AIC)                              169971.155
  Bayesian (BIC)                            170099.354
  Sample-size adjusted Bayesian (SABIC)     170042.153

Root Mean Square Error of Approximation:

  RMSEA                                          0.102
  90 Percent confidence interval - lower         0.098
  90 Percent confidence interval - upper         0.106
  P-value H_0: RMSEA &lt;= 0.050                    0.000
  P-value H_0: RMSEA &gt;= 0.080                    1.000

Standardized Root Mean Square Residual:

  SRMR                                           0.050

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Latent Variables:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  lvh =~                                              
    ESCS              1.000                           
    HOMEPOS           1.133    0.012   91.099    0.000
    ST007Q01JA       -0.435    0.012  -37.662    0.000
    ST256Q02JA        0.947    0.020   46.529    0.000
    ST255Q01JA        1.381    0.019   72.078    0.000
  lvc =~                                              
    PV1MATH           1.000                           
 [ reached getOption("max.print") -- omitted 1 row ]

Regressions:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  PV1SCIE ~                                           
    lvh               0.012    0.009    1.326    0.185
    lvc               0.991    0.008  121.309    0.000

Covariances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  lvh ~~                                              
    lvc               0.282    0.008   33.407    0.000

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .ESCS              0.239    0.005   46.204    0.000
   .HOMEPOS           0.148    0.005   28.609    0.000
   .ST007Q01JA        0.495    0.007   66.043    0.000
   .ST256Q02JA        1.448    0.022   65.016    0.000
   .ST255Q01JA        0.963    0.016   58.664    0.000
   .PV1MATH           0.122    0.004   30.114    0.000
   .PV1READ           0.293    0.005   56.485    0.000
   .PV1SCIE           0.155    0.004   36.360    0.000
 [ reached getOption("max.print") -- omitted 2 rows ]</code></pre>
</div>
</div>
<p>Going through the fit measures of that model:</p>
<blockquote class="blockquote">
<p>P-value (Chi-square) 0.000</p>
</blockquote>
<p>The p-value is less than 0.05 suggesting a poor fit</p>
<blockquote class="blockquote">
<p>Comparative Fit Index (CFI) 0.958 Tucker-Lewis Index (TLI) 0.934</p>
</blockquote>
<p>The CFI is over 0.95 suggesting a good fit and the TLI over 0.90 suggesting an acceptable fit, but not quite reaching the threshold for a good fit.</p>
<blockquote class="blockquote">
<p>Root Mean Square Error of Approximation: RMSEA 0.102 90 Percent confidence interval - lower 0.098 90 Percent confidence interval - upper 0.106</p>
</blockquote>
<p>The RMS error term is 0.102 with the 90% confidence interval between 0.098 and 0.106. An RMSEA of 0.102 suggests poor fit, as it exceeds common thresholds for acceptable fit: Good fit: &lt; 0.06; Acceptable fit: 0.06–0.08 and Poor fit: &gt; 0.08.</p>
<p>As is commonly the case, the model indicators make different suggestions of the goodness of the model’s fit. Overall this seems like not the best fitting model.</p>
</section>
<section id="improving-model-fit" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="improving-model-fit"><span class="header-section-number">1.5</span> Improving model fit</h2>
<p>After examining the fit of a model, the next step can be to look at the model modification indices which suggest how the model might be improved.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">modificationIndices</span>(fit, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       lhs op        rhs      mi    epc sepc.lv sepc.all sepc.nox
29    ESCS ~~ ST007Q01JA 827.487 -0.126  -0.126   -0.366   -0.366
35 HOMEPOS ~~ ST007Q01JA 581.688  0.108   0.108    0.398    0.398
31    ESCS ~~ ST255Q01JA 371.288 -0.163  -0.163   -0.339   -0.339
27     lvc =~ ST255Q01JA 220.413  0.210   0.193    0.139    0.139
30    ESCS ~~ ST256Q02JA 206.117 -0.111  -0.111   -0.189   -0.189
 [ reached 'max' / getOption("max.print") -- omitted 29 rows ]</code></pre>
</div>
</div>
<p>The table output suggest ways to improve the model to improve the fit. <strong><em>One should be cautious about making changes to a model based purely on such modification indices. The model should fit theory</em></strong>. The <code>lhs</code> and <code>rhs</code> columns refer to the left hand side and right hand side of the equation. The <code>ops</code> column refers to the operator, this suggests the type of relationship that might be added to improve the model:</p>
<blockquote class="blockquote">
<p>~~ (Covariance or Correlation) - you might add: ‘ESCS ~~ ST007Q01JA’ to the model</p>
</blockquote>
<blockquote class="blockquote">
<p>=~ (Latent Variable Measurement Relationship) - suggests adding a new latent variable to your model: lvc =~ ST255Q01JA</p>
</blockquote>
<p>The suggestions to improve are ranked by the <code>mi</code> improvement. <code>mi</code> is a measure of how much the models chi-square value would decrease if you added the additional term. For example, adding <code>ESCS ~~  ST007Q01JA</code> would bring the chi-square value down by 827.487.</p>
<p>The <code>epc</code> is the Expected Parameter Change - the expected value of the new term (covariance, or factor loading). For example, looking at the <code>epc</code> term for <code>ESCS   ~~  ST007Q01JA</code> - if this term were added to the model, that relationship would be expected to have a covariance of -0.126.</p>
<p>We can then add the suggested terms and compare model fit, adding the top two suggestions: <code>ESCS    ~~  ST007Q01JA</code> (a covariance between social class and father’s highest level of schooling) and <code>HOMEPOS    ~~  ST007Q01JA</code> (a covariance between wealth and father’s highest level of schooling) . It is important to check those additions cohere with theory. The item <code>ST007Q01JA</code> asks: “What is the [highest level of schooling] completed by your father?” which is plausibly linked to wealth (<code>HOMEPOS</code>) and social class (<code>ESCS</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># Propose a modified model </span></span>
<span id="cb19-2"><a href="#cb19-2"></a></span>
<span id="cb19-3"><a href="#cb19-3"></a>model2<span class="ot">&lt;-</span><span class="st">"lvh =~ ESCS + HOMEPOS + ST007Q01JA + ST256Q02JA + ST255Q01JA  </span></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="st">        lvc =~ PV1MATH + PV1READ</span></span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="st">        PV1SCIE ~ lvh + lvc</span></span>
<span id="cb19-6"><a href="#cb19-6"></a><span class="st">        ESCS    ~~  ST007Q01JA</span></span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="st">        HOMEPOS ~~  ST007Q01JA"</span></span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="co"># Fit the model</span></span>
<span id="cb19-9"><a href="#cb19-9"></a>fit<span class="ot">&lt;-</span><span class="fu">sem</span>(model2, <span class="at">data =</span> UKdata)                                        </span>
<span id="cb19-10"><a href="#cb19-10"></a><span class="fu">summary</span>(fit, , <span class="at">fit.measures =</span> <span class="cn">TRUE</span>)                                   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6-19 ended normally after 35 iterations

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                        20

                                                  Used       Total
  Number of observations                          9156       12972

Model Test User Model:
                                                      
  Test statistic                               799.870
  Degrees of freedom                                16
  P-value (Chi-square)                           0.000

Model Test Baseline Model:

  Test statistic                             40961.751
  Degrees of freedom                                28
  P-value                                        0.000

User Model versus Baseline Model:

  Comparative Fit Index (CFI)                    0.981
  Tucker-Lewis Index (TLI)                       0.966

Loglikelihood and Information Criteria:

  Loglikelihood user model (H0)             -84495.786
  Loglikelihood unrestricted model (H1)     -84095.851
                                                      
  Akaike (AIC)                              169031.571
  Bayesian (BIC)                            169174.015
  Sample-size adjusted Bayesian (SABIC)     169110.458

Root Mean Square Error of Approximation:

  RMSEA                                          0.073
  90 Percent confidence interval - lower         0.069
  90 Percent confidence interval - upper         0.078
  P-value H_0: RMSEA &lt;= 0.050                    0.000
  P-value H_0: RMSEA &gt;= 0.080                    0.005

Standardized Root Mean Square Residual:

  SRMR                                           0.046

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Latent Variables:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  lvh =~                                              
    ESCS              1.000                           
    HOMEPOS           1.200    0.014   88.080    0.000
    ST007Q01JA       -0.444    0.013  -33.205    0.000
    ST256Q02JA        0.975    0.021   46.603    0.000
    ST255Q01JA        1.409    0.020   70.700    0.000
  lvc =~                                              
    PV1MATH           1.000                           
 [ reached getOption("max.print") -- omitted 1 row ]

Regressions:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  PV1SCIE ~                                           
    lvh               0.011    0.009    1.257    0.209
    lvc               0.991    0.008  122.469    0.000

Covariances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
 .ESCS ~~                                             
   .ST007Q01JA       -0.096    0.006  -15.847    0.000
 .HOMEPOS ~~                                          
   .ST007Q01JA        0.051    0.005    9.415    0.000
  lvh ~~                                              
    lvc               0.266    0.008   32.581    0.000

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .ESCS              0.267    0.005   49.180    0.000
   .HOMEPOS           0.109    0.005   20.128    0.000
   .ST007Q01JA        0.498    0.008   60.311    0.000
   .ST256Q02JA        1.448    0.022   65.363    0.000
   .ST255Q01JA        0.980    0.017   59.302    0.000
   .PV1MATH           0.122    0.004   30.121    0.000
   .PV1READ           0.293    0.005   56.476    0.000
   .PV1SCIE           0.155    0.004   36.338    0.000
 [ reached getOption("max.print") -- omitted 2 rows ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>)                                </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="06-1-SEM_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>If we compare the model fit indices in the improved model to the original:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 12%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 8%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th>Fit Measure</th>
<th>Model 1</th>
<th>Model 2</th>
<th>Improvement?</th>
<th>Comments on Change</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Chi-Square</strong></td>
<td>1743.454 (df = 18)</td>
<td>799.870 (df = 16)</td>
<td><strong>Yes</strong></td>
<td>Significant reduction in chi-square, indicating better fit for Model 2.</td>
</tr>
<tr class="even">
<td><strong>CFI</strong></td>
<td>0.958</td>
<td>0.981</td>
<td><strong>Yes</strong></td>
<td>CFI improved and is now closer to 1, indicating better incremental model fit.</td>
</tr>
<tr class="odd">
<td><strong>TLI</strong></td>
<td>0.934</td>
<td>0.966</td>
<td><strong>Yes</strong></td>
<td>TLI improved, indicating better parsimony-adjusted fit for Model 2.</td>
</tr>
<tr class="even">
<td><strong>RMSEA</strong></td>
<td>0.102</td>
<td>0.073</td>
<td><strong>Yes</strong></td>
<td>RMSEA decreased, moving below 0.08, indicating improved absolute model fit.</td>
</tr>
<tr class="odd">
<td><strong>RMSEA CI (90%)</strong></td>
<td>0.098–0.106</td>
<td>0.069–0.078</td>
<td><strong>Yes</strong></td>
<td>Narrower confidence interval for RMSEA in Model 2 reflects increased precision.</td>
</tr>
</tbody>
</table>
<p>The second model is an improvement, across all fit indices, suggesting the adjustments better capture the structure of the data.</p>
<section id="reporting-the-measurement-model" class="level3" data-number="1.5.1">
<h3 data-number="1.5.1" class="anchored" data-anchor-id="reporting-the-measurement-model"><span class="header-section-number">1.5.1</span> Reporting the measurement model</h3>
<p>Once you have finalised your model, you will want to report various aspects of your SEM. Typically you will be interested in the factor loadings (the standardised coefficients representing the paths between variables). The loadings are displayed on your path diagram but you can produce an output of the loadings separately. For example for <code>model2</code> above which attempts to model science scores with a latent home and cognitive item, you can extract the factor loadings using the <code>standardizedsolution</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># Propose a modified model </span></span>
<span id="cb22-2"><a href="#cb22-2"></a></span>
<span id="cb22-3"><a href="#cb22-3"></a>model2<span class="ot">&lt;-</span><span class="st">"lvh =~ ESCS + HOMEPOS + ST007Q01JA + ST256Q02JA + ST255Q01JA  </span></span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="st">        lvc =~ PV1MATH + PV1READ</span></span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="st">        PV1SCIE ~ lvh + lvc</span></span>
<span id="cb22-6"><a href="#cb22-6"></a><span class="st">        ESCS    ~~  ST007Q01JA</span></span>
<span id="cb22-7"><a href="#cb22-7"></a><span class="st">        HOMEPOS ~~  ST007Q01JA"</span></span>
<span id="cb22-8"><a href="#cb22-8"></a></span>
<span id="cb22-9"><a href="#cb22-9"></a><span class="co"># Fit the model</span></span>
<span id="cb22-10"><a href="#cb22-10"></a>fit<span class="ot">&lt;-</span><span class="fu">sem</span>(model2, <span class="at">data =</span> UKdata)                                        </span>
<span id="cb22-11"><a href="#cb22-11"></a></span>
<span id="cb22-12"><a href="#cb22-12"></a><span class="co"># Extract loadings</span></span>
<span id="cb22-13"><a href="#cb22-13"></a></span>
<span id="cb22-14"><a href="#cb22-14"></a><span class="fu">standardizedsolution</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  lhs op        rhs est.std    se       z pvalue ci.lower ci.upper
1 lvh =~       ESCS   0.800 0.005 163.229      0    0.790    0.810
2 lvh =~    HOMEPOS   0.929 0.004 244.563      0    0.921    0.936
3 lvh =~ ST007Q01JA  -0.398 0.012 -33.752      0   -0.421   -0.375
4 lvh =~ ST256Q02JA   0.488 0.009  57.051      0    0.471    0.504
 [ reached 'max' / getOption("max.print") -- omitted 18 rows ]</code></pre>
</div>
</div>
<p>The output table gives you a list of the factor loadings between pairs of variables. For example, the first pair is the latent variable for the home environment (<code>lvh</code>) and social class (<code>ESCS</code>). The loading estimate is given in the <code>est.std</code> column - 0.800 in this case. The columns <code>ci.lower</code> and <code>ci.upper</code> give the 95% confidence interval for the loading.The <code>pvalue</code> column returns the p-value for the loading. There is no well defined cut off in the literature, but if you have variables that have low loadings you may wish to reconsider their inclusion in the model.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>There is disagreement in the literature as concerns the cut off for low factor loading. For example Hulland <span class="citation" data-cites="hulland1999use">(<a href="#ref-hulland1999use" role="doc-biblioref">1999</a>)</span> suggests adopting the value commonly used in factor analysis, &lt; 0.4. By contrast, Fornell and Larcker <span class="citation" data-cites="fornell1981evaluating">(<a href="#ref-fornell1981evaluating" role="doc-biblioref">1981</a>)</span> recommend 0.7 and Chin <span class="citation" data-cites="chin1998partial">(<a href="#ref-chin1998partial" role="doc-biblioref">1998</a>)</span> prefers 0.707. Decisions will be field dependent so it is worth reading papers in your field to get a sense of the conventions in your discipline.</p>
</div>
</div>
<p>Another useful measure are the R<sup>2</sup> values for each item in the model. Each item is treated as a dependent variable and an R<sup>2</sup> value (the proportion of variance it explains) can be calculated using the <code>parameterEstimates</code> function. We then filter for the operator related to R<sup>2</sup> and select the relevant columns to make the data easier to read. An <code>arrange</code> in descending order can also be useful.</p>
<p>The estimates here should be thought of as the percentage of variance of that item that is explained by the latent variable it is associated with.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># Extract R^2 values for the model</span></span>
<span id="cb24-2"><a href="#cb24-2"></a></span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="fu">parameterEstimates</span>(fit, <span class="at">rsquare =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="#cb24-4"></a>  <span class="fu">filter</span>(op <span class="sc">==</span> <span class="st">"r2"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-5"><a href="#cb24-5"></a>  <span class="fu">select</span>(<span class="at">Item=</span>rhs, <span class="at">R2 =</span> est) <span class="sc">%&gt;%</span></span>
<span id="cb24-6"><a href="#cb24-6"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(R2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Item    R2
1    PV1MATH 0.873
2    HOMEPOS 0.862
3    PV1SCIE 0.843
4    PV1READ 0.693
5       ESCS 0.640
6 ST255Q01JA 0.490
7 ST256Q02JA 0.238
8 ST007Q01JA 0.159</code></pre>
</div>
</div>
<p>For example, <code>ESCS</code> in the model is associated with <code>lvh</code>, the home environment latent variable. Therefore the R<sup>2</sup> value here indicates that 61% of the variance in <code>ESCS</code> is explained by <code>lvh</code>.</p>
</section>
</section>
<section id="seminar-activities" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="seminar-activities"><span class="header-section-number">1.6</span> Seminar activities</h2>
<section id="task-1---create-a-model-of-science-score" class="level3" data-number="1.6.1">
<h3 data-number="1.6.1" class="anchored" data-anchor-id="task-1---create-a-model-of-science-score"><span class="header-section-number">1.6.1</span> Task 1 - create a model of science score</h3>
<div class="question">
<p>Consider the mathematics score in the PISA data (<code>PV1SCIE</code>). On a piece of paper, draw out a path diagram of the variables that might influence science score. Try and estimate the relative strength of the effect of those variables on mathematics score. You might consider variables such as <code>IQ</code> and <code>teacher_quality</code>.</p>
</div>
</section>
<section id="task-2---create-a-model-of-science-score" class="level3" data-number="1.6.2">
<h3 data-number="1.6.2" class="anchored" data-anchor-id="task-2---create-a-model-of-science-score"><span class="header-section-number">1.6.2</span> Task 2 - create a model of science score</h3>
<div class="question">
<p>Now, try to create an SEM for science score in the UK. Let us assume that the variables theory suggest you include in your model are ability at mathematics and reading (<code>PV1MATH</code> and <code>PV1READ</code>) and wealth (<code>HOMEPOS</code>). Build a simple model in which those three variables have a direct relationship to science score, but don’t influence each other.</p>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Don’t forget to convert any non-numeric variables to numeric</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># Create a data frame for UK science scores, with the varibales we need</span></span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="co"># For the model: Math, science, reading and wealth (HOMEPOS)</span></span>
<span id="cb26-3"><a href="#cb26-3"></a></span>
<span id="cb26-4"><a href="#cb26-4"></a></span>
<span id="cb26-5"><a href="#cb26-5"></a>UK_Sci_data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb26-6"><a href="#cb26-6"></a>  <span class="fu">select</span>(CNT, HOMEPOS, PV1READ, PV1SCIE, PV1MATH) <span class="sc">%&gt;%</span></span>
<span id="cb26-7"><a href="#cb26-7"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="cb26-8"><a href="#cb26-8"></a></span>
<span id="cb26-9"><a href="#cb26-9"></a><span class="co"># Scale the the test scores so they are similar to the already scaled</span></span>
<span id="cb26-10"><a href="#cb26-10"></a><span class="co"># HOMEPOS score (i.e. have a mean of 0 and a sd of 1)</span></span>
<span id="cb26-11"><a href="#cb26-11"></a></span>
<span id="cb26-12"><a href="#cb26-12"></a>UK_Sci_data <span class="ot">&lt;-</span> UK_Sci_data <span class="sc">%&gt;%</span></span>
<span id="cb26-13"><a href="#cb26-13"></a>  <span class="fu">mutate</span>(<span class="at">PV1MATH =</span> <span class="fu">scale</span>(PV1MATH),</span>
<span id="cb26-14"><a href="#cb26-14"></a>         <span class="at">PV1SCIE =</span> <span class="fu">scale</span>(PV1SCIE),</span>
<span id="cb26-15"><a href="#cb26-15"></a>         <span class="at">PV1READ =</span> <span class="fu">scale</span>(PV1READ))</span>
<span id="cb26-16"><a href="#cb26-16"></a></span>
<span id="cb26-17"><a href="#cb26-17"></a></span>
<span id="cb26-18"><a href="#cb26-18"></a>model<span class="ot">&lt;-</span><span class="st">"PV1SCIE ~ HOMEPOS + PV1MATH + PV1READ"</span></span>
<span id="cb26-19"><a href="#cb26-19"></a></span>
<span id="cb26-20"><a href="#cb26-20"></a>fit<span class="ot">&lt;-</span><span class="fu">sem</span>(model, <span class="at">data =</span> UK_Sci_data)</span>
<span id="cb26-21"><a href="#cb26-21"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6-19 ended normally after 1 iteration

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                         4

                                                  Used       Total
  Number of observations                         11487       12972

Model Test User Model:
                                                      
  Test statistic                                 0.000
  Degrees of freedom                                 0

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Regressions:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  PV1SCIE ~                                           
    HOMEPOS           0.044    0.005    8.202    0.000
    PV1MATH           0.657    0.007   87.934    0.000
    PV1READ           0.251    0.007   34.147    0.000

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .PV1SCIE           0.239    0.003   75.786    0.000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="06-1-SEM_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-3---create-a-model-of-reading-score" class="level3" data-number="1.6.3">
<h3 data-number="1.6.3" class="anchored" data-anchor-id="task-3---create-a-model-of-reading-score"><span class="header-section-number">1.6.3</span> Task 3 - create a model of reading score</h3>
<div class="question">
<p>Make a SEM of reading scores in the PISA data for students in the United States. Consider co-variation between independent variables. First consider what independent variables in the data set might influence reading scores. Some potential items of interest include:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 79%">
</colgroup>
<thead>
<tr class="header">
<th>Item name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ST005Q01JA</td>
<td>What is the <highest level="" of="" schooling=""> completed by your mother?</highest></td>
</tr>
<tr class="even">
<td>ST007Q01JA</td>
<td>What is the <highest level="" of="" schooling=""> completed by your father?</highest></td>
</tr>
<tr class="odd">
<td>ST256Q02JA</td>
<td>In your home: Classic literature (e.g.&nbsp;<shakespeare>)</shakespeare></td>
</tr>
<tr class="even">
<td>ST255Q01JA</td>
<td>How many books are there in your home?</td>
</tr>
<tr class="odd">
<td>HOMEPOS</td>
<td>Family Wealth</td>
</tr>
<tr class="even">
<td>ESCS</td>
<td>Index of economic, social and cultural status</td>
</tr>
<tr class="odd">
<td>ST254Q02JA</td>
<td>How many of the following [digital devices] are in your</td>
</tr>
<tr class="even">
<td></td>
<td>[home]: Desktop computers</td>
</tr>
</tbody>
</table>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Don’t forget to convert any non-numeric variables to numeric</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># Using ST255Q01JA  How many books are there in your home?</span></span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="co"># ST254Q02JA    How many in your home: Computers (desktop computer, portable laptop, or notebook)</span></span>
<span id="cb29-3"><a href="#cb29-3"></a></span>
<span id="cb29-4"><a href="#cb29-4"></a>USdata <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb29-5"><a href="#cb29-5"></a>  <span class="fu">select</span>(CNT, ESCS, HOMEPOS, PV1READ, ST255Q01JA, ST254Q02JA) <span class="sc">%&gt;%</span></span>
<span id="cb29-6"><a href="#cb29-6"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United States"</span>)</span>
<span id="cb29-7"><a href="#cb29-7"></a></span>
<span id="cb29-8"><a href="#cb29-8"></a><span class="co"># Making ST255Q01JA and ST012Q06NA numeric</span></span>
<span id="cb29-9"><a href="#cb29-9"></a></span>
<span id="cb29-10"><a href="#cb29-10"></a>USdata<span class="sc">$</span>ST255Q01JA <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(USdata<span class="sc">$</span>ST255Q01JA)</span>
<span id="cb29-11"><a href="#cb29-11"></a>USdata<span class="sc">$</span>ST254Q02JA <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(USdata<span class="sc">$</span>ST254Q02JA)</span>
<span id="cb29-12"><a href="#cb29-12"></a></span>
<span id="cb29-13"><a href="#cb29-13"></a><span class="co"># Scale the numeric variables</span></span>
<span id="cb29-14"><a href="#cb29-14"></a></span>
<span id="cb29-15"><a href="#cb29-15"></a>USdata <span class="ot">&lt;-</span> USdata <span class="sc">%&gt;%</span></span>
<span id="cb29-16"><a href="#cb29-16"></a>  <span class="fu">mutate</span>(<span class="at">ESCS =</span> <span class="fu">scale</span>(ESCS),</span>
<span id="cb29-17"><a href="#cb29-17"></a>         <span class="at">HOMEPOS =</span> <span class="fu">scale</span>(HOMEPOS),</span>
<span id="cb29-18"><a href="#cb29-18"></a>         <span class="at">PV1READ =</span> <span class="fu">scale</span>(PV1READ))</span>
<span id="cb29-19"><a href="#cb29-19"></a></span>
<span id="cb29-20"><a href="#cb29-20"></a></span>
<span id="cb29-21"><a href="#cb29-21"></a>model<span class="ot">&lt;-</span><span class="st">"PV1READ ~ ESCS + HOMEPOS + ST255Q01JA+ ST254Q02JA"</span></span>
<span id="cb29-22"><a href="#cb29-22"></a></span>
<span id="cb29-23"><a href="#cb29-23"></a>fit<span class="ot">&lt;-</span><span class="fu">sem</span>(model, <span class="at">data =</span> USdata)</span>
<span id="cb29-24"><a href="#cb29-24"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6-19 ended normally after 1 iteration

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                         5

                                                  Used       Total
  Number of observations                          4163        4552

Model Test User Model:
                                                      
  Test statistic                                 0.000
  Degrees of freedom                                 0

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Regressions:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  PV1READ ~                                           
    ESCS              0.132    0.021    6.390    0.000
    HOMEPOS           0.127    0.025    5.141    0.000
    ST255Q01JA        0.190    0.013   14.965    0.000
    ST254Q02JA       -0.186    0.019   -9.642    0.000

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .PV1READ           0.802    0.018   45.623    0.000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="06-1-SEM_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-4---create-a-model-of-mathematics-score" class="level3" data-number="1.6.4">
<h3 data-number="1.6.4" class="anchored" data-anchor-id="task-4---create-a-model-of-mathematics-score"><span class="header-section-number">1.6.4</span> Task 4 - create a model of mathematics score</h3>
<div class="question">
<p>Create a model of mathematics scores in the UK, using the predictors gender (<code>ST004D01T</code>), reading score (<code>PV1READ</code>), wealth (<code>HOMEPOS</code>), and social class (<code>ESCS</code>).</p>
<p>Hint: remember to turn gender into a numeric variable, and scale the other items.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># Create a data frame with the required base variables</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>UKdata<span class="ot">&lt;-</span>PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3"></a>  <span class="fu">select</span>(CNT, ESCS, HOMEPOS, PV1READ, PV1MATH, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="cb32-5"><a href="#cb32-5"></a></span>
<span id="cb32-6"><a href="#cb32-6"></a><span class="co"># ST004D01T is currently a character variable ("Male", "Female", "NA"). Recode to be numeric</span></span>
<span id="cb32-7"><a href="#cb32-7"></a></span>
<span id="cb32-8"><a href="#cb32-8"></a>UKdata<span class="sc">$</span>ST004D01T <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST004D01T )</span>
<span id="cb32-9"><a href="#cb32-9"></a></span>
<span id="cb32-10"><a href="#cb32-10"></a><span class="co"># Scale the numeric variables</span></span>
<span id="cb32-11"><a href="#cb32-11"></a></span>
<span id="cb32-12"><a href="#cb32-12"></a>UKdata <span class="ot">&lt;-</span> UKdata <span class="sc">%&gt;%</span></span>
<span id="cb32-13"><a href="#cb32-13"></a>  <span class="fu">mutate</span>(<span class="at">ESCS =</span> <span class="fu">scale</span>(ESCS),</span>
<span id="cb32-14"><a href="#cb32-14"></a>         <span class="at">HOMEPOS =</span> <span class="fu">scale</span>(HOMEPOS),</span>
<span id="cb32-15"><a href="#cb32-15"></a>         <span class="at">PV1READ =</span> <span class="fu">scale</span>(PV1READ),</span>
<span id="cb32-16"><a href="#cb32-16"></a>         <span class="at">PV1MATH =</span> <span class="fu">scale</span>(PV1MATH))</span>
<span id="cb32-17"><a href="#cb32-17"></a>         </span>
<span id="cb32-18"><a href="#cb32-18"></a><span class="co"># Create the model</span></span>
<span id="cb32-19"><a href="#cb32-19"></a></span>
<span id="cb32-20"><a href="#cb32-20"></a>model<span class="ot">&lt;-</span><span class="st">"PV1MATH ~ ESCS + HOMEPOS + PV1READ + ST004D01T"</span></span>
<span id="cb32-21"><a href="#cb32-21"></a></span>
<span id="cb32-22"><a href="#cb32-22"></a>fit<span class="ot">&lt;-</span><span class="fu">sem</span>(model, <span class="at">data =</span> UKdata)</span>
<span id="cb32-23"><a href="#cb32-23"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6-19 ended normally after 1 iteration

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                         5

                                                  Used       Total
  Number of observations                         11083       12972

Model Test User Model:
                                                      
  Test statistic                                 0.000
  Degrees of freedom                                 0

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Regressions:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  PV1MATH ~                                           
    ESCS              0.098    0.009   11.428    0.000
    HOMEPOS           0.043    0.009    5.023    0.000
    PV1READ           0.758    0.006  128.427    0.000
    ST004D01T         0.299    0.011   26.569    0.000

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .PV1MATH           0.346    0.005   74.441    0.000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="06-1-SEM_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-5---modelling-a-latent-variable-for-the-home-digital-environment" class="level3" data-number="1.6.5">
<h3 data-number="1.6.5" class="anchored" data-anchor-id="task-5---modelling-a-latent-variable-for-the-home-digital-environment"><span class="header-section-number">1.6.5</span> Task 5 - Modelling a latent variable for the home digital environment</h3>
<div class="question">
<p>There are a number of variables in the PISA data set that could be used to model the digital environment in the home (e.g.&nbsp;number of computers, having internet access etc.). Develop a latent variable for the home digital environment and model it using the variables in the data set.</p>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Don’t forget to convert any non-numeric variables to numeric</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># Using:</span></span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="co"># ST253Q01JA</span></span>
<span id="cb35-3"><a href="#cb35-3"></a><span class="co"># "How many [digital devices] with screens are there in your [home]?"</span></span>
<span id="cb35-4"><a href="#cb35-4"></a><span class="co"># ST254Q02JA "How many of the following [digital devices] are in your [home]: Desktop computers"</span></span>
<span id="cb35-5"><a href="#cb35-5"></a><span class="co"># ST254Q03JA "How many of the following [digital devices] are in your [home]: Laptop computers or notebooks"</span></span>
<span id="cb35-6"><a href="#cb35-6"></a><span class="co"># ST254Q06JA "How many of the following [digital devices] are in your [home]: [Cell phones] with Internet access (i.e. smartphones)"</span></span>
<span id="cb35-7"><a href="#cb35-7"></a></span>
<span id="cb35-8"><a href="#cb35-8"></a></span>
<span id="cb35-9"><a href="#cb35-9"></a>UKdata <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb35-10"><a href="#cb35-10"></a>  <span class="fu">select</span>(CNT, ST253Q01JA, ST254Q02JA, ST254Q03JA, ST254Q06JA)<span class="sc">%&gt;%</span></span>
<span id="cb35-11"><a href="#cb35-11"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="cb35-12"><a href="#cb35-12"></a></span>
<span id="cb35-13"><a href="#cb35-13"></a><span class="co"># Making variables numeric</span></span>
<span id="cb35-14"><a href="#cb35-14"></a></span>
<span id="cb35-15"><a href="#cb35-15"></a>UKdata<span class="sc">$</span>ST253Q01JA <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST253Q01JA)</span>
<span id="cb35-16"><a href="#cb35-16"></a>UKdata<span class="sc">$</span>ST254Q02JA <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST254Q02JA)</span>
<span id="cb35-17"><a href="#cb35-17"></a>UKdata<span class="sc">$</span>ST254Q03JA <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST254Q03JA)</span>
<span id="cb35-18"><a href="#cb35-18"></a>UKdata<span class="sc">$</span>ST254Q06JA <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST254Q06JA)</span>
<span id="cb35-19"><a href="#cb35-19"></a></span>
<span id="cb35-20"><a href="#cb35-20"></a>model<span class="ot">&lt;-</span><span class="st">"lv =~ ST253Q01JA + ST254Q02JA + ST254Q03JA + ST254Q06JA "</span></span>
<span id="cb35-21"><a href="#cb35-21"></a></span>
<span id="cb35-22"><a href="#cb35-22"></a>fit <span class="ot">&lt;-</span> <span class="fu">sem</span>(model, <span class="at">data =</span> UKdata)</span>
<span id="cb35-23"><a href="#cb35-23"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6-19 ended normally after 26 iterations

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                         8

                                                  Used       Total
  Number of observations                         10808       12972

Model Test User Model:
                                                      
  Test statistic                               115.285
  Degrees of freedom                                 2
  P-value (Chi-square)                           0.000

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Latent Variables:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  lv =~                                               
    ST253Q01JA        1.000                           
    ST254Q02JA        0.756    0.032   23.271    0.000
    ST254Q03JA        0.980    0.039   25.364    0.000
    ST254Q06JA        0.727    0.029   25.363    0.000

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .ST253Q01JA        0.694    0.012   59.085    0.000
   .ST254Q02JA        0.485    0.008   61.839    0.000
   .ST254Q03JA        0.325    0.007   43.548    0.000
   .ST254Q06JA        0.245    0.005   51.354    0.000
    lv                0.167    0.010   16.998    0.000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="06-1-SEM_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-6---building-a-more-complex-latent-variable-in-sem" class="level3" data-number="1.6.6">
<h3 data-number="1.6.6" class="anchored" data-anchor-id="task-6---building-a-more-complex-latent-variable-in-sem"><span class="header-section-number">1.6.6</span> Task 6 - building a more complex latent variable in SEM</h3>
<div class="question">
<p>You believe that there are two latent variables underlying UK students’ performance in science - a science self-identity variable (related to the home environment, for example, gender, parents’ level of education) and a cognitive ability variable (indicated by performance in other subjects). Propose a model of science performance based on these two latent variables - linking each latent variable to multiple independent variables. Determine how much variance your model explains.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="co"># Create a UK data frame with plausible values for reading math and science</span></span>
<span id="cb38-2"><a href="#cb38-2"></a></span>
<span id="cb38-3"><a href="#cb38-3"></a>UKdata <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb38-4"><a href="#cb38-4"></a>  <span class="fu">select</span>(CNT, ESCS, HOMEPOS, ST005Q01JA, ST007Q01JA, PV1READ, PV1SCIE, </span>
<span id="cb38-5"><a href="#cb38-5"></a>         PV1MATH, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb38-6"><a href="#cb38-6"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="cb38-7"><a href="#cb38-7"></a></span>
<span id="cb38-8"><a href="#cb38-8"></a><span class="co"># Convert to numeric where not numeric</span></span>
<span id="cb38-9"><a href="#cb38-9"></a></span>
<span id="cb38-10"><a href="#cb38-10"></a>UKdata<span class="sc">$</span>ST005Q01JA <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST005Q01JA)</span>
<span id="cb38-11"><a href="#cb38-11"></a>UKdata<span class="sc">$</span>ST007Q01JA <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST007Q01JA)</span>
<span id="cb38-12"><a href="#cb38-12"></a>UKdata<span class="sc">$</span>ST004D01T <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST004D01T)</span>
<span id="cb38-13"><a href="#cb38-13"></a></span>
<span id="cb38-14"><a href="#cb38-14"></a><span class="co"># Scale the test scores</span></span>
<span id="cb38-15"><a href="#cb38-15"></a></span>
<span id="cb38-16"><a href="#cb38-16"></a>UKdata<span class="sc">$</span>PV1READ <span class="ot">&lt;-</span> <span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1READ)</span>
<span id="cb38-17"><a href="#cb38-17"></a>UKdata<span class="sc">$</span>PV1MATH <span class="ot">&lt;-</span> <span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1MATH)</span>
<span id="cb38-18"><a href="#cb38-18"></a>UKdata<span class="sc">$</span>PV1SCIE <span class="ot">&lt;-</span> <span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1SCIE)</span>
<span id="cb38-19"><a href="#cb38-19"></a></span>
<span id="cb38-20"><a href="#cb38-20"></a><span class="co"># Propose a model with two latent variables - one related to identity (lvi), the other ability (lva)</span></span>
<span id="cb38-21"><a href="#cb38-21"></a></span>
<span id="cb38-22"><a href="#cb38-22"></a>model<span class="ot">&lt;-</span><span class="st">"lvi =~ ESCS + HOMEPOS + ST005Q01JA + ST007Q01JA + ST004D01T</span></span>
<span id="cb38-23"><a href="#cb38-23"></a><span class="st">        lva =~ PV1MATH + PV1READ</span></span>
<span id="cb38-24"><a href="#cb38-24"></a><span class="st">        PV1SCIE ~ lvi + lva"</span></span>
<span id="cb38-25"><a href="#cb38-25"></a></span>
<span id="cb38-26"><a href="#cb38-26"></a><span class="co"># Fit the model</span></span>
<span id="cb38-27"><a href="#cb38-27"></a>fit<span class="ot">&lt;-</span><span class="fu">sem</span>(model, <span class="at">data=</span>UKdata)</span>
<span id="cb38-28"><a href="#cb38-28"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6-19 ended normally after 34 iterations

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                        18

                                                  Used       Total
  Number of observations                          9683       12972

Model Test User Model:
                                                      
  Test statistic                              1738.699
  Degrees of freedom                                18
  P-value (Chi-square)                           0.000

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Latent Variables:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  lvi =~                                              
    ESCS              1.000                           
    HOMEPOS           0.833    0.010   79.702    0.000
    ST005Q01JA       -0.430    0.008  -51.306    0.000
    ST007Q01JA       -0.437    0.009  -47.015    0.000
    ST004D01T         0.001    0.006    0.175    0.861
  lva =~                                              
    PV1MATH           1.000                           
 [ reached getOption("max.print") -- omitted 1 row ]

Regressions:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  PV1SCIE ~                                           
    lvi               0.004    0.007    0.518    0.605
    lva               0.991    0.008  131.633    0.000

Covariances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  lvi ~~                                              
    lva               0.312    0.009   33.677    0.000

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .ESCS              0.046    0.007    7.049    0.000
   .HOMEPOS           0.327    0.007   49.672    0.000
   .ST005Q01JA        0.366    0.005   67.130    0.000
   .ST007Q01JA        0.470    0.007   67.762    0.000
   .ST004D01T         0.250    0.004   69.581    0.000
   .PV1MATH           0.122    0.004   30.788    0.000
   .PV1READ           0.296    0.005   57.937    0.000
   .PV1SCIE           0.157    0.004   37.728    0.000
 [ reached getOption("max.print") -- omitted 2 rows ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="06-1-SEM_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-7---check-the-model-you-built-in-step-6-for-goodness-of-model-fit-and-improve-it" class="level3" data-number="1.6.7">
<h3 data-number="1.6.7" class="anchored" data-anchor-id="task-7---check-the-model-you-built-in-step-6-for-goodness-of-model-fit-and-improve-it"><span class="header-section-number">1.6.7</span> Task 7 - Check the model you built in step 6 for goodness of model fit and improve it</h3>
<div class="question">
<p>Using the model you developed in task 6: a) assess the model fit - how good is your model? b) use model modification indices to improve your model</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="co"># Create a UK data frame with plausible values for reading math and science</span></span>
<span id="cb41-2"><a href="#cb41-2"></a></span>
<span id="cb41-3"><a href="#cb41-3"></a>UKdata <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb41-4"><a href="#cb41-4"></a>  <span class="fu">select</span>(CNT, ESCS, HOMEPOS, ST005Q01JA, ST007Q01JA, PV1READ, PV1SCIE, </span>
<span id="cb41-5"><a href="#cb41-5"></a>         PV1MATH, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb41-6"><a href="#cb41-6"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="cb41-7"><a href="#cb41-7"></a></span>
<span id="cb41-8"><a href="#cb41-8"></a><span class="co"># Convert to numeric where not numeric</span></span>
<span id="cb41-9"><a href="#cb41-9"></a></span>
<span id="cb41-10"><a href="#cb41-10"></a>UKdata<span class="sc">$</span>ST005Q01JA <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST005Q01JA)</span>
<span id="cb41-11"><a href="#cb41-11"></a>UKdata<span class="sc">$</span>ST007Q01JA <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST007Q01JA)</span>
<span id="cb41-12"><a href="#cb41-12"></a>UKdata<span class="sc">$</span>ST004D01T <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST004D01T)</span>
<span id="cb41-13"><a href="#cb41-13"></a></span>
<span id="cb41-14"><a href="#cb41-14"></a><span class="co"># Scale the test scores</span></span>
<span id="cb41-15"><a href="#cb41-15"></a></span>
<span id="cb41-16"><a href="#cb41-16"></a>UKdata<span class="sc">$</span>PV1READ <span class="ot">&lt;-</span> <span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1READ)</span>
<span id="cb41-17"><a href="#cb41-17"></a>UKdata<span class="sc">$</span>PV1MATH <span class="ot">&lt;-</span> <span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1MATH)</span>
<span id="cb41-18"><a href="#cb41-18"></a>UKdata<span class="sc">$</span>PV1SCIE <span class="ot">&lt;-</span> <span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1SCIE)</span>
<span id="cb41-19"><a href="#cb41-19"></a></span>
<span id="cb41-20"><a href="#cb41-20"></a><span class="co"># Propose a model with two latent variables - one related to identity (lvi), the other ability (lva)</span></span>
<span id="cb41-21"><a href="#cb41-21"></a></span>
<span id="cb41-22"><a href="#cb41-22"></a>model<span class="ot">&lt;-</span><span class="st">"lvi =~ ESCS + HOMEPOS + ST005Q01JA + ST007Q01JA + ST004D01T</span></span>
<span id="cb41-23"><a href="#cb41-23"></a><span class="st">        lva =~ PV1MATH + PV1READ</span></span>
<span id="cb41-24"><a href="#cb41-24"></a><span class="st">        PV1SCIE ~ lvi + lva"</span></span>
<span id="cb41-25"><a href="#cb41-25"></a></span>
<span id="cb41-26"><a href="#cb41-26"></a><span class="co"># Fit the model</span></span>
<span id="cb41-27"><a href="#cb41-27"></a>fit<span class="ot">&lt;-</span><span class="fu">sem</span>(model, <span class="at">data=</span>UKdata)</span>
<span id="cb41-28"><a href="#cb41-28"></a><span class="fu">summary</span>(fit, <span class="at">fit.measures =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6-19 ended normally after 34 iterations

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                        18

                                                  Used       Total
  Number of observations                          9683       12972

Model Test User Model:
                                                      
  Test statistic                              1738.699
  Degrees of freedom                                18
  P-value (Chi-square)                           0.000

Model Test Baseline Model:

  Test statistic                             39656.333
  Degrees of freedom                                28
  P-value                                        0.000

User Model versus Baseline Model:

  Comparative Fit Index (CFI)                    0.957
  Tucker-Lewis Index (TLI)                       0.932

Loglikelihood and Information Criteria:

  Loglikelihood user model (H0)             -76178.452
  Loglikelihood unrestricted model (H1)     -75309.102
                                                      
  Akaike (AIC)                              152392.903
  Bayesian (BIC)                            152522.109
  Sample-size adjusted Bayesian (SABIC)     152464.908

Root Mean Square Error of Approximation:

  RMSEA                                          0.099
  90 Percent confidence interval - lower         0.095
  90 Percent confidence interval - upper         0.103
  P-value H_0: RMSEA &lt;= 0.050                    0.000
  P-value H_0: RMSEA &gt;= 0.080                    1.000

Standardized Root Mean Square Residual:

  SRMR                                           0.051

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Latent Variables:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  lvi =~                                              
    ESCS              1.000                           
    HOMEPOS           0.833    0.010   79.702    0.000
    ST005Q01JA       -0.430    0.008  -51.306    0.000
    ST007Q01JA       -0.437    0.009  -47.015    0.000
    ST004D01T         0.001    0.006    0.175    0.861
  lva =~                                              
    PV1MATH           1.000                           
 [ reached getOption("max.print") -- omitted 1 row ]

Regressions:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  PV1SCIE ~                                           
    lvi               0.004    0.007    0.518    0.605
    lva               0.991    0.008  131.633    0.000

Covariances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  lvi ~~                                              
    lva               0.312    0.009   33.677    0.000

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .ESCS              0.046    0.007    7.049    0.000
   .HOMEPOS           0.327    0.007   49.672    0.000
   .ST005Q01JA        0.366    0.005   67.130    0.000
   .ST007Q01JA        0.470    0.007   67.762    0.000
   .ST004D01T         0.250    0.004   69.581    0.000
   .PV1MATH           0.122    0.004   30.788    0.000
   .PV1READ           0.296    0.005   57.937    0.000
   .PV1SCIE           0.157    0.004   37.728    0.000
 [ reached getOption("max.print") -- omitted 2 rows ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="co"># Evaluating my models fit</span></span>
<span id="cb43-2"><a href="#cb43-2"></a><span class="co"># Chi square is 0.000 which is &lt;0.05 suggesting a poor fit</span></span>
<span id="cb43-3"><a href="#cb43-3"></a><span class="co"># CFI is &gt;0.95 suggesting good fit</span></span>
<span id="cb43-4"><a href="#cb43-4"></a><span class="co"># TLI is &lt;0.95 but &gt;0.90 suggesting adequate fit</span></span>
<span id="cb43-5"><a href="#cb43-5"></a><span class="co"># RMSEA is 0.099 suggesting a poor fit - RMSEA ≥ 0.08</span></span>
<span id="cb43-6"><a href="#cb43-6"></a></span>
<span id="cb43-7"><a href="#cb43-7"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="06-1-SEM_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="fu">modificationIndices</span>(fit, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          lhs op        rhs      mi    epc sepc.lv sepc.all sepc.nox
28       ESCS ~~    HOMEPOS 625.697  0.355   0.355    2.881    2.881
51  ST004D01T ~~    PV1READ 620.983 -0.075  -0.075   -0.274   -0.274
23        lva =~       ESCS 402.131 -0.174  -0.163   -0.187   -0.187
41 ST005Q01JA ~~ ST007Q01JA 366.790  0.085   0.085    0.204    0.204
50  ST004D01T ~~    PV1MATH 318.059  0.042   0.042    0.243    0.243
 [ reached 'max' / getOption("max.print") -- omitted 29 rows ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="co">#  The top two suggestions here are adding 'ESCS    ~~  HOMEPOS' and 'ST004D01T ~~  PV1READ'</span></span>
<span id="cb46-2"><a href="#cb46-2"></a><span class="co"># These seems sensible based on my knowledge of theory - there is likely to be a link between social class and HOMEPOS and reading has a larger gender difference than other achievment variables. Let's add those two.</span></span>
<span id="cb46-3"><a href="#cb46-3"></a></span>
<span id="cb46-4"><a href="#cb46-4"></a>model_2 <span class="ot">&lt;-</span><span class="st">"lvi =~ ESCS + HOMEPOS + ST005Q01JA + ST007Q01JA + ST004D01T</span></span>
<span id="cb46-5"><a href="#cb46-5"></a><span class="st">        lva =~ PV1MATH + PV1READ</span></span>
<span id="cb46-6"><a href="#cb46-6"></a><span class="st">        PV1SCIE ~ lvi + lva</span></span>
<span id="cb46-7"><a href="#cb46-7"></a><span class="st">        ESCS    ~~  HOMEPOS</span></span>
<span id="cb46-8"><a href="#cb46-8"></a><span class="st">        ST004D01T   ~~  PV1READ"</span></span>
<span id="cb46-9"><a href="#cb46-9"></a></span>
<span id="cb46-10"><a href="#cb46-10"></a><span class="co"># Fit the model</span></span>
<span id="cb46-11"><a href="#cb46-11"></a>fit<span class="ot">&lt;-</span><span class="fu">sem</span>(model_2, <span class="at">data=</span>UKdata)</span>
<span id="cb46-12"><a href="#cb46-12"></a><span class="fu">summary</span>(fit, <span class="at">fit.measures =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6-19 ended normally after 37 iterations

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                        20

                                                  Used       Total
  Number of observations                          9683       12972

Model Test User Model:
                                                      
  Test statistic                               494.401
  Degrees of freedom                                16
  P-value (Chi-square)                           0.000

Model Test Baseline Model:

  Test statistic                             39656.333
  Degrees of freedom                                28
  P-value                                        0.000

User Model versus Baseline Model:

  Comparative Fit Index (CFI)                    0.988
  Tucker-Lewis Index (TLI)                       0.979

Loglikelihood and Information Criteria:

  Loglikelihood user model (H0)             -75556.303
  Loglikelihood unrestricted model (H1)     -75309.102
                                                      
  Akaike (AIC)                              151152.605
  Bayesian (BIC)                            151296.168
  Sample-size adjusted Bayesian (SABIC)     151232.611

Root Mean Square Error of Approximation:

  RMSEA                                          0.056
  90 Percent confidence interval - lower         0.051
  90 Percent confidence interval - upper         0.060
  P-value H_0: RMSEA &lt;= 0.050                    0.014
  P-value H_0: RMSEA &gt;= 0.080                    0.000

Standardized Root Mean Square Residual:

  SRMR                                           0.036

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Latent Variables:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  lvi =~                                              
    ESCS              1.000                           
    HOMEPOS           0.755    0.012   65.509    0.000
    ST005Q01JA       -0.661    0.015  -45.568    0.000
    ST007Q01JA       -0.683    0.015  -44.208    0.000
    ST004D01T        -0.001    0.008   -0.090    0.928
  lva =~                                              
    PV1MATH           1.000                           
 [ reached getOption("max.print") -- omitted 1 row ]

Regressions:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  PV1SCIE ~                                           
    lvi               0.014    0.010    1.358    0.175
    lva               0.980    0.008  125.505    0.000

Covariances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
 .ESCS ~~                                             
   .HOMEPOS           0.246    0.009   27.936    0.000
 .ST004D01T ~~                                        
   .PV1READ          -0.075    0.003  -24.362    0.000
  lvi ~~                                              
    lva               0.290    0.009   32.933    0.000

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .ESCS              0.295    0.009   31.270    0.000
   .HOMEPOS           0.556    0.011   51.743    0.000
   .ST005Q01JA        0.296    0.006   51.425    0.000
   .ST007Q01JA        0.391    0.007   55.416    0.000
   .ST004D01T         0.250    0.004   69.581    0.000
   .PV1MATH           0.115    0.004   30.307    0.000
   .PV1READ           0.296    0.005   57.729    0.000
   .PV1SCIE           0.164    0.004   40.329    0.000
 [ reached getOption("max.print") -- omitted 2 rows ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="co"># Evaluating my models fit</span></span>
<span id="cb48-2"><a href="#cb48-2"></a><span class="co"># Chi square is 0.000 suggesting still a poor fit (but the chi-square statistics has come down from:  1738.699 to 494.401)</span></span>
<span id="cb48-3"><a href="#cb48-3"></a><span class="co"># CFI is &gt;0.988 suggesting good fit -this has gone up!</span></span>
<span id="cb48-4"><a href="#cb48-4"></a><span class="co"># TLI is  0.979 which is an improvement</span></span>
<span id="cb48-5"><a href="#cb48-5"></a><span class="co"># RMSEA is now 0.056, down from 0.099 so still a poor fit but getting closer!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="task-8---report-the-factor-loadings-and-r2-for-your-model" class="level3" data-number="1.6.8">
<h3 data-number="1.6.8" class="anchored" data-anchor-id="task-8---report-the-factor-loadings-and-r2-for-your-model"><span class="header-section-number">1.6.8</span> Task 8 - Report the factor loadings and R2 for your model</h3>
<div class="question">
<p>In task 6, you built a model of two latent variables underlying UK students’ performance in science - a science self-identity variable (related to the home environment, for example, gender, parents’ level of education) and a cognitive ability variable (indicated by performance in other subjects).</p>
<p>You have modified the model using modification indices. Now extract the factor loadings and the R^2@ of your items. Discuss what the coefficients tell you about the variables in your model.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="co"># Create a UK data frame with plausible values for reading math and science</span></span>
<span id="cb49-2"><a href="#cb49-2"></a></span>
<span id="cb49-3"><a href="#cb49-3"></a>UKdata <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb49-4"><a href="#cb49-4"></a>  <span class="fu">select</span>(CNT, ESCS, HOMEPOS, ST005Q01JA, ST007Q01JA, PV1READ, PV1SCIE, </span>
<span id="cb49-5"><a href="#cb49-5"></a>         PV1MATH, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb49-6"><a href="#cb49-6"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="cb49-7"><a href="#cb49-7"></a></span>
<span id="cb49-8"><a href="#cb49-8"></a><span class="co"># Convert to numeric where not numeric</span></span>
<span id="cb49-9"><a href="#cb49-9"></a></span>
<span id="cb49-10"><a href="#cb49-10"></a>UKdata<span class="sc">$</span>ST005Q01JA <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST005Q01JA)</span>
<span id="cb49-11"><a href="#cb49-11"></a>UKdata<span class="sc">$</span>ST007Q01JA <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST007Q01JA)</span>
<span id="cb49-12"><a href="#cb49-12"></a>UKdata<span class="sc">$</span>ST004D01T <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST004D01T)</span>
<span id="cb49-13"><a href="#cb49-13"></a></span>
<span id="cb49-14"><a href="#cb49-14"></a><span class="co"># Scale the test scores</span></span>
<span id="cb49-15"><a href="#cb49-15"></a></span>
<span id="cb49-16"><a href="#cb49-16"></a>UKdata<span class="sc">$</span>PV1READ <span class="ot">&lt;-</span> <span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1READ)</span>
<span id="cb49-17"><a href="#cb49-17"></a>UKdata<span class="sc">$</span>PV1MATH <span class="ot">&lt;-</span> <span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1MATH)</span>
<span id="cb49-18"><a href="#cb49-18"></a>UKdata<span class="sc">$</span>PV1SCIE <span class="ot">&lt;-</span> <span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1SCIE)</span>
<span id="cb49-19"><a href="#cb49-19"></a></span>
<span id="cb49-20"><a href="#cb49-20"></a><span class="co"># Re-enter the revised model with two latent variables - one related to identity (lvi), the other ability (lva)</span></span>
<span id="cb49-21"><a href="#cb49-21"></a></span>
<span id="cb49-22"><a href="#cb49-22"></a>model_2 <span class="ot">&lt;-</span><span class="st">"lvi =~ ESCS + HOMEPOS + ST005Q01JA + ST007Q01JA + ST004D01T</span></span>
<span id="cb49-23"><a href="#cb49-23"></a><span class="st">        lva =~ PV1MATH + PV1READ</span></span>
<span id="cb49-24"><a href="#cb49-24"></a><span class="st">        PV1SCIE ~ lvi + lva</span></span>
<span id="cb49-25"><a href="#cb49-25"></a><span class="st">        ESCS    ~~  HOMEPOS</span></span>
<span id="cb49-26"><a href="#cb49-26"></a><span class="st">        ST004D01T   ~~  PV1READ"</span></span>
<span id="cb49-27"><a href="#cb49-27"></a></span>
<span id="cb49-28"><a href="#cb49-28"></a><span class="co"># Fit the model</span></span>
<span id="cb49-29"><a href="#cb49-29"></a>fit<span class="ot">&lt;-</span><span class="fu">sem</span>(model_2, <span class="at">data=</span>UKdata)</span>
<span id="cb49-30"><a href="#cb49-30"></a></span>
<span id="cb49-31"><a href="#cb49-31"></a><span class="co"># Extract loadings</span></span>
<span id="cb49-32"><a href="#cb49-32"></a><span class="fu">standardizedsolution</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  lhs op        rhs est.std    se       z pvalue ci.lower ci.upper
1 lvi =~       ESCS   0.781 0.008  95.470      0    0.765    0.797
2 lvi =~    HOMEPOS   0.566 0.010  54.588      0    0.546    0.587
3 lvi =~ ST005Q01JA  -0.636 0.009 -73.977      0   -0.653   -0.620
4 lvi =~ ST007Q01JA  -0.596 0.009 -67.514      0   -0.613   -0.578
 [ reached 'max' / getOption("max.print") -- omitted 18 rows ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="co"># The self-identity latent variable loads strongly to social class (0.781) and less strongly to</span></span>
<span id="cb51-2"><a href="#cb51-2"></a><span class="co"># wealth (0.566). Curiously, it has a strong negative loading (-0.636) to mother's highest level of</span></span>
<span id="cb51-3"><a href="#cb51-3"></a><span class="co"># schooling (ST005Q01JA) and to father's level of schooling (ST007Q01JA) (-0.596). Self-identity loads </span></span>
<span id="cb51-4"><a href="#cb51-4"></a><span class="co"># very weakly to gender (-0.001). The loading for gender is not significant. By contrast the achievement </span></span>
<span id="cb51-5"><a href="#cb51-5"></a><span class="co"># test scores PV1MATH (0.941) and PV1READ (0.842) load strongly on the achievement latent variable (lva)</span></span>
<span id="cb51-6"><a href="#cb51-6"></a></span>
<span id="cb51-7"><a href="#cb51-7"></a><span class="co"># Extract R^2</span></span>
<span id="cb51-8"><a href="#cb51-8"></a></span>
<span id="cb51-9"><a href="#cb51-9"></a><span class="fu">parameterEstimates</span>(fit, <span class="at">rsquare =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-10"><a href="#cb51-10"></a>  <span class="fu">filter</span>(op <span class="sc">==</span> <span class="st">"r2"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb51-11"><a href="#cb51-11"></a>  <span class="fu">select</span>(<span class="at">Item=</span>rhs, <span class="at">R2 =</span> est) <span class="sc">%&gt;%</span></span>
<span id="cb51-12"><a href="#cb51-12"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(R2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Item    R2
1    PV1MATH 0.885
2    PV1SCIE 0.839
3    PV1READ 0.708
4       ESCS 0.609
5 ST005Q01JA 0.405
6 ST007Q01JA 0.355
7    HOMEPOS 0.321
8  ST004D01T 0.000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="co"># The achievement variables are the best explained by the achievement latent variable</span></span>
<span id="cb53-2"><a href="#cb53-2"></a><span class="co"># 88.5% of the mathematics score, 83.9% of the science score and 70.8% of the reading score are </span></span>
<span id="cb53-3"><a href="#cb53-3"></a><span class="co"># explained by the latent achievement variable (lva)</span></span>
<span id="cb53-4"><a href="#cb53-4"></a><span class="co"># The self-identity variable explains less of the variance - accounting for 60.9% of social class (ESCS)</span></span>
<span id="cb53-5"><a href="#cb53-5"></a><span class="co"># 32.1% of wealth (HOMEPOS) and 40.5% of mother's occupation (ST005Q01JA) and  35.5% of father's </span></span>
<span id="cb53-6"><a href="#cb53-6"></a><span class="co"># occupation (ST005Q01JA). As the loading and its p-value led us to expect - gender is not explained</span></span>
<span id="cb53-7"><a href="#cb53-7"></a><span class="co"># by the latent variable (0%)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="task-9---create-your-own-model-of-overall-achievement-in-hong-kong-china" class="level3" data-number="1.6.9">
<h3 data-number="1.6.9" class="anchored" data-anchor-id="task-9---create-your-own-model-of-overall-achievement-in-hong-kong-china"><span class="header-section-number">1.6.9</span> Task 9 - Create your own model of overall achievement in Hong Kong (China)</h3>
<div class="question">
<p>Develop your own SEM model of overall achievement in Hong Kong (China). I have chosen Hong Kong as it has the least missing data. Create a new variable <code>z_pv_overall</code> which is the mean score across <code>PV1READ</code>, <code>PV1MATH</code>, and <code>PV1SCIE</code>. Do then use <code>scale</code> to standardise the score.</p>
<p>Reflect on the theory you know and select a range of variables (recall the function <code>lapply(PISA_2022, attr, "label")</code> will give you the names of all the times) to build a model of overall achievement. Do include some latent variables of your choice.</p>
<p>Perform checks of model fit for your first model and use modification indices to improve the model. Report the factor loads, and R<sup>2</sup> terms. Discuss what your model tells you about overall achievement in PISA data for the UK.</p>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Do check all the items you choose have data for the UK before building your model</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="co"># Create a Hong Kong data frame with required variables</span></span>
<span id="cb54-2"><a href="#cb54-2"></a></span>
<span id="cb54-3"><a href="#cb54-3"></a>HK_data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb54-4"><a href="#cb54-4"></a>  <span class="fu">select</span>(CNT, PV1READ, PV1SCIE, PV1MATH, BELONG, DISCLIM,</span>
<span id="cb54-5"><a href="#cb54-5"></a>         ST016Q01NA, WB150Q01HA, WB156Q01HA) <span class="sc">%&gt;%</span> <span class="co"># Rename for ease</span></span>
<span id="cb54-6"><a href="#cb54-6"></a>         <span class="fu">rename</span>(<span class="at">sat =</span> ST016Q01NA, </span>
<span id="cb54-7"><a href="#cb54-7"></a>                <span class="at">hel =</span> WB150Q01HA, </span>
<span id="cb54-8"><a href="#cb54-8"></a>                <span class="at">fri =</span> WB156Q01HA) <span class="sc">%&gt;%</span></span>
<span id="cb54-9"><a href="#cb54-9"></a>  <span class="fu">mutate</span>(<span class="at">hel =</span> <span class="fu">case_when</span>(hel <span class="sc">==</span> <span class="st">"Very good"</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb54-10"><a href="#cb54-10"></a>                         hel <span class="sc">==</span> <span class="st">"Good"</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb54-11"><a href="#cb54-11"></a>                         hel <span class="sc">==</span> <span class="st">"Fair"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb54-12"><a href="#cb54-12"></a>                         hel <span class="sc">==</span> <span class="st">"Poor"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb54-13"><a href="#cb54-13"></a>                         hel <span class="sc">==</span> <span class="st">"Very poor"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb54-14"><a href="#cb54-14"></a>                         <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span>)) <span class="sc">%&gt;%</span> <span class="co"># Convert to numeric</span></span>
<span id="cb54-15"><a href="#cb54-15"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"Hong Kong (China)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-16"><a href="#cb54-16"></a>  <span class="fu">mutate</span>(<span class="at">z_pv_overall =</span> <span class="fu">scale</span>(PV1READ <span class="sc">+</span> PV1MATH <span class="sc">+</span> PV1SCIE <span class="sc">/</span><span class="dv">3</span>)) <span class="sc">%&gt;%</span> <span class="co">#  scaled overall achievement score</span></span>
<span id="cb54-17"><a href="#cb54-17"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(z_pv_overall),</span>
<span id="cb54-18"><a href="#cb54-18"></a>         <span class="sc">!</span><span class="fu">is.na</span>(sat),</span>
<span id="cb54-19"><a href="#cb54-19"></a>         <span class="sc">!</span><span class="fu">is.na</span>(hel),</span>
<span id="cb54-20"><a href="#cb54-20"></a>         <span class="sc">!</span><span class="fu">is.na</span>(fri))</span>
<span id="cb54-21"><a href="#cb54-21"></a></span>
<span id="cb54-22"><a href="#cb54-22"></a><span class="co"># Create a model with two latent variables</span></span>
<span id="cb54-23"><a href="#cb54-23"></a><span class="co"># lvw - wellbeing</span></span>
<span id="cb54-24"><a href="#cb54-24"></a><span class="co"># ST016Q01NA "Overall, how satisfied are you with your life as a whole these days?"</span></span>
<span id="cb54-25"><a href="#cb54-25"></a><span class="co"># WB150Q01HA "How is your health?"</span></span>
<span id="cb54-26"><a href="#cb54-26"></a><span class="co"># WB156Q01HA "At present, how many close friends do you have?"</span></span>
<span id="cb54-27"><a href="#cb54-27"></a></span>
<span id="cb54-28"><a href="#cb54-28"></a><span class="co">#</span></span>
<span id="cb54-29"><a href="#cb54-29"></a><span class="co"># lve - school environment</span></span>
<span id="cb54-30"><a href="#cb54-30"></a><span class="co"># DISCLIM "Disciplinary climate in mathematics (WLE)"</span></span>
<span id="cb54-31"><a href="#cb54-31"></a><span class="co"># BELONG  "Sense of belonging (WLE)"</span></span>
<span id="cb54-32"><a href="#cb54-32"></a><span class="co"># </span></span>
<span id="cb54-33"><a href="#cb54-33"></a></span>
<span id="cb54-34"><a href="#cb54-34"></a><span class="co"># define the model</span></span>
<span id="cb54-35"><a href="#cb54-35"></a>model_well_school <span class="ot">&lt;-</span> <span class="st">"lvw =~  sat + hel + fri</span></span>
<span id="cb54-36"><a href="#cb54-36"></a><span class="st">        lve =~ BELONG + DISCLIM</span></span>
<span id="cb54-37"><a href="#cb54-37"></a><span class="st">        z_pv_overall ~ lvw + lve"</span></span>
<span id="cb54-38"><a href="#cb54-38"></a></span>
<span id="cb54-39"><a href="#cb54-39"></a><span class="co"># Fit the model</span></span>
<span id="cb54-40"><a href="#cb54-40"></a>fit<span class="ot">&lt;-</span><span class="fu">sem</span>(model_well_school, <span class="at">data =</span> HK_data)</span>
<span id="cb54-41"><a href="#cb54-41"></a></span>
<span id="cb54-42"><a href="#cb54-42"></a><span class="co"># plot</span></span>
<span id="cb54-43"><a href="#cb54-43"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="06-1-SEM_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="co"># Extract loadings</span></span>
<span id="cb55-2"><a href="#cb55-2"></a><span class="fu">standardizedsolution</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  lhs op    rhs est.std    se      z pvalue ci.lower ci.upper
1 lvw =~    sat   0.661 0.030 22.147  0.000    0.602    0.719
2 lvw =~    hel   0.421 0.023 18.446  0.000    0.376    0.465
3 lvw =~    fri   0.077 0.022  3.459  0.001    0.034    0.121
4 lve =~ BELONG   0.445 0.035 12.754  0.000    0.376    0.513
 [ reached 'max' / getOption("max.print") -- omitted 12 rows ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="co"># For the latent variable lvw (Well-being)  sat (satisfaction): Factor loading = 0.661 has a strong and significant relationship with well-being. Health has a moderate ( 0.421) and significant relationship with well-being. Friends have a very weak (0.077) but statistically significant relationship with well-being, suggesting it contributes very little to the construct.</span></span>
<span id="cb57-2"><a href="#cb57-2"></a><span class="co"># For lve (School environment) Belonging has a moderate (0.445) and significant relationship with the school environment.Disciplinary climate has a weaker (0.262) but still statistically significant relationship with the school environment.</span></span>
<span id="cb57-3"><a href="#cb57-3"></a><span class="co"># Overall z_pv_overall ~ lvw (effect of well-being on the outcome):not significant, p=0.518. There is no significant relationship between well-being and z_pv_overall in this model.</span></span>
<span id="cb57-4"><a href="#cb57-4"></a><span class="co"># z_pv_overall ~ lve (effect of school environment on the outcome): not significant, </span></span>
<span id="cb57-5"><a href="#cb57-5"></a><span class="co"># p = 0.424. Interpretation: The school environment does not have a significant impact on z_pv_overall in # this model.</span></span>
<span id="cb57-6"><a href="#cb57-6"></a></span>
<span id="cb57-7"><a href="#cb57-7"></a><span class="co"># Extract R^2</span></span>
<span id="cb57-8"><a href="#cb57-8"></a></span>
<span id="cb57-9"><a href="#cb57-9"></a><span class="fu">parameterEstimates</span>(fit, <span class="at">rsquare =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb57-10"><a href="#cb57-10"></a>  <span class="fu">filter</span>(op <span class="sc">==</span> <span class="st">"r2"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb57-11"><a href="#cb57-11"></a>  <span class="fu">select</span>(<span class="at">Item=</span>rhs, <span class="at">R2 =</span> est) <span class="sc">%&gt;%</span></span>
<span id="cb57-12"><a href="#cb57-12"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(R2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Item    R2
1          sat 0.437
2       BELONG 0.198
3          hel 0.177
4 z_pv_overall 0.154
5      DISCLIM 0.069
6          fri 0.006</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="co"># Approximately 43.7% of the variance in life satisfaction is explained by the latent variable lvw (well-being). This is a relatively strong R2 indicating that sat is a meaningful and well-explained indicator of well-being. About 19.8% of the variance in sense of belonging is explained by the latent variable lve (school environment). While this is a moderate level of explanation, it suggests that there may be other unmeasured factors influencing the sense of belonging.</span></span>
<span id="cb59-2"><a href="#cb59-2"></a></span>
<span id="cb59-3"><a href="#cb59-3"></a><span class="co"># Outcome Variable (z_pv_overall): The weak R2 (15%)  highlights the need for additional predictors or model refinements to better explain its variance.</span></span>
<span id="cb59-4"><a href="#cb59-4"></a></span>
<span id="cb59-5"><a href="#cb59-5"></a><span class="co"># Model fit</span></span>
<span id="cb59-6"><a href="#cb59-6"></a><span class="fu">summary</span>(fit, <span class="at">fit.measures =</span> <span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6-19 ended normally after 70 iterations

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                        14

                                                  Used       Total
  Number of observations                          3546        3566

Model Test User Model:
                                                      
  Test statistic                               201.830
  Degrees of freedom                                 7
  P-value (Chi-square)                           0.000

Model Test Baseline Model:

  Test statistic                              1020.125
  Degrees of freedom                                15
  P-value                                        0.000

User Model versus Baseline Model:

  Comparative Fit Index (CFI)                    0.806
  Tucker-Lewis Index (TLI)                       0.585

Loglikelihood and Information Criteria:

  Loglikelihood user model (H0)             -34625.193
  Loglikelihood unrestricted model (H1)     -34524.278
                                                      
  Akaike (AIC)                               69278.387
  Bayesian (BIC)                             69364.817
  Sample-size adjusted Bayesian (SABIC)      69320.332

Root Mean Square Error of Approximation:

  RMSEA                                          0.089
  90 Percent confidence interval - lower         0.078
  90 Percent confidence interval - upper         0.099
  P-value H_0: RMSEA &lt;= 0.050                    0.000
  P-value H_0: RMSEA &gt;= 0.080                    0.916

Standardized Root Mean Square Residual:

  SRMR                                           0.049

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Latent Variables:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  lvw =~                                              
    sat               1.000                           
    hel               0.174    0.015   11.638    0.000
    fri               0.329    0.097    3.382    0.001
  lve =~                                              
    BELONG            1.000                           
    DISCLIM           0.866    0.088    9.815    0.000

Regressions:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  z_pv_overall ~                                      
    lvw              -0.593    0.925   -0.641    0.521
    lve               3.741    4.906    0.763    0.446

Covariances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  lvw ~~                                              
    lve               0.362    0.022   16.174    0.000

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .sat               2.526    0.178   14.181    0.000
   .hel               0.277    0.008   33.191    0.000
   .fri              35.248    0.841   41.908    0.000
   .BELONG            0.306    0.013   23.336    0.000
   .DISCLIM           0.768    0.020   38.411    0.000
   .z_pv_overall      0.773    0.165    4.699    0.000
    lvw               1.959    0.189   10.339    0.000
    lve               0.075    0.012    6.195    0.000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a><span class="co"># The chi square p-value is 0 - indicating poor fit</span></span>
<span id="cb61-2"><a href="#cb61-2"></a><span class="co"># The CFI of 0.806 is not adequate</span></span>
<span id="cb61-3"><a href="#cb61-3"></a><span class="co"># The TLI of 0.585 is poor</span></span>
<span id="cb61-4"><a href="#cb61-4"></a><span class="co"># The RMSEA of 0.089 suggesting a moderate fit</span></span>
<span id="cb61-5"><a href="#cb61-5"></a></span>
<span id="cb61-6"><a href="#cb61-6"></a><span class="co"># Run model improvement indices</span></span>
<span id="cb61-7"><a href="#cb61-7"></a><span class="fu">modificationIndices</span>(fit, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      lhs op          rhs     mi    epc sepc.lv sepc.all sepc.nox
33    fri ~~ z_pv_overall 86.614 -0.883  -0.883   -0.169   -0.169
31    fri ~~       BELONG 67.582  0.504   0.504    0.154    0.154
17    lvw =~       BELONG 46.064  0.737   1.032    1.671    1.671
18    lvw =~      DISCLIM 46.064 -0.639  -0.894   -0.984   -0.984
35 BELONG ~~ z_pv_overall 46.063 -0.130  -0.130   -0.267   -0.267
 [ reached 'max' / getOption("max.print") -- omitted 14 rows ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="co"># The improvement indices suggest adding: fri ~~ z_pv_overall, fri ~~ BELONG, lvw =~  BELONG, lvw =~      DISCLIM. These make some sense from a theoretical point of view</span></span>
<span id="cb63-2"><a href="#cb63-2"></a></span>
<span id="cb63-3"><a href="#cb63-3"></a><span class="co"># the new model becomes</span></span>
<span id="cb63-4"><a href="#cb63-4"></a></span>
<span id="cb63-5"><a href="#cb63-5"></a>model_well_school_2 <span class="ot">&lt;-</span> <span class="st">"lvw =~  sat + hel + fri</span></span>
<span id="cb63-6"><a href="#cb63-6"></a><span class="st">        lve =~ BELONG + DISCLIM</span></span>
<span id="cb63-7"><a href="#cb63-7"></a><span class="st">        z_pv_overall ~ lvw + lve</span></span>
<span id="cb63-8"><a href="#cb63-8"></a><span class="st">        fri ~~ z_pv_overall</span></span>
<span id="cb63-9"><a href="#cb63-9"></a><span class="st">        fri ~~ BELONG</span></span>
<span id="cb63-10"><a href="#cb63-10"></a><span class="st">        lvw =~  DISCLIM"</span></span>
<span id="cb63-11"><a href="#cb63-11"></a></span>
<span id="cb63-12"><a href="#cb63-12"></a><span class="co"># Fit the revised model</span></span>
<span id="cb63-13"><a href="#cb63-13"></a>fit<span class="ot">&lt;-</span><span class="fu">sem</span>(model_well_school_2, <span class="at">data =</span> HK_data)</span>
<span id="cb63-14"><a href="#cb63-14"></a></span>
<span id="cb63-15"><a href="#cb63-15"></a><span class="co"># plot</span></span>
<span id="cb63-16"><a href="#cb63-16"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="06-1-SEM_files/figure-html/unnamed-chunk-29-2.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="co"># Extract loadings</span></span>
<span id="cb64-2"><a href="#cb64-2"></a><span class="fu">standardizedsolution</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  lhs op    rhs est.std    se      z pvalue ci.lower ci.upper
1 lvw =~    sat   0.679 0.032 21.566  0.000    0.618    0.741
2 lvw =~    hel   0.414 0.023 17.948  0.000    0.369    0.459
3 lvw =~    fri   0.046 0.023  1.988  0.047    0.001    0.091
4 lve =~ BELONG   0.422 0.023 18.085  0.000    0.376    0.467
 [ reached 'max' / getOption("max.print") -- omitted 15 rows ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="co"># The environment latent variable is now significant (p=0.039) where in the first model it was not not significant  (p = 0.424). The wellbeing latent varibale remains not significant (p=0.071) - it was 0.424 in the first model. </span></span>
<span id="cb66-2"><a href="#cb66-2"></a></span>
<span id="cb66-3"><a href="#cb66-3"></a><span class="co"># Extract R^2</span></span>
<span id="cb66-4"><a href="#cb66-4"></a></span>
<span id="cb66-5"><a href="#cb66-5"></a><span class="fu">parameterEstimates</span>(fit, <span class="at">rsquare =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-6"><a href="#cb66-6"></a>  <span class="fu">filter</span>(op <span class="sc">==</span> <span class="st">"r2"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb66-7"><a href="#cb66-7"></a>  <span class="fu">select</span>(<span class="at">Item=</span>rhs, <span class="at">R2 =</span> est) <span class="sc">%&gt;%</span></span>
<span id="cb66-8"><a href="#cb66-8"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(R2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Item    R2
1      DISCLIM 0.903
2          sat 0.462
3       BELONG 0.178
4          hel 0.171
5 z_pv_overall 0.040
6          fri 0.002</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a><span class="co"># Overall the explanatory power of the model is still low - the low latent variables only explaining </span></span>
<span id="cb68-2"><a href="#cb68-2"></a><span class="co"># 4% of the variation in the outcome variable. This is a reduction from the first model where the </span></span>
<span id="cb68-3"><a href="#cb68-3"></a><span class="co"># z_pv_overall variable was explained by 15% of the latent variables. The second model does explain</span></span>
<span id="cb68-4"><a href="#cb68-4"></a><span class="co"># some of the variables - "DISCLIM" R2 rose from 6.9% to 90% and "sat" from 43.7% to  46.2%</span></span>
<span id="cb68-5"><a href="#cb68-5"></a></span>
<span id="cb68-6"><a href="#cb68-6"></a><span class="co"># Model fit</span></span>
<span id="cb68-7"><a href="#cb68-7"></a><span class="fu">summary</span>(fit, <span class="at">fit.measures =</span> <span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6-19 ended normally after 223 iterations

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                        17

                                                  Used       Total
  Number of observations                          3546        3566

Model Test User Model:
                                                      
  Test statistic                                27.209
  Degrees of freedom                                 4
  P-value (Chi-square)                           0.000

Model Test Baseline Model:

  Test statistic                              1020.125
  Degrees of freedom                                15
  P-value                                        0.000

User Model versus Baseline Model:

  Comparative Fit Index (CFI)                    0.977
  Tucker-Lewis Index (TLI)                       0.913

Loglikelihood and Information Criteria:

  Loglikelihood user model (H0)             -34537.883
  Loglikelihood unrestricted model (H1)     -34524.278
                                                      
  Akaike (AIC)                               69109.765
  Bayesian (BIC)                             69214.716
  Sample-size adjusted Bayesian (SABIC)      69160.699

Root Mean Square Error of Approximation:

  RMSEA                                          0.040
  90 Percent confidence interval - lower         0.027
  90 Percent confidence interval - upper         0.055
  P-value H_0: RMSEA &lt;= 0.050                    0.844
  P-value H_0: RMSEA &gt;= 0.080                    0.000

Standardized Root Mean Square Residual:

  SRMR                                           0.017

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Latent Variables:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  lvw =~                                              
    sat               1.000                           
    hel               0.167    0.015   11.182    0.000
    fri               0.191    0.097    1.968    0.049
  lve =~                                              
    BELONG            1.000                           
    DISCLIM          34.038  114.828    0.296    0.767
  lvw =~                                              
 [ reached getOption("max.print") -- omitted 1 row ]

Regressions:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  z_pv_overall ~                                      
    lvw              -0.776    0.441   -1.757    0.079
    lve               4.875    2.296    2.123    0.034

Covariances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
 .fri ~~                                              
   .z_pv_overall     -0.779    0.095   -8.174    0.000
   .BELONG            0.443    0.062    7.168    0.000
  lvw ~~                                              
    lve               0.373    0.023   16.462    0.000

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .sat               2.415    0.193   12.537    0.000
   .hel               0.278    0.008   33.293    0.000
   .fri              35.386    0.842   42.026    0.000
   .BELONG            0.314    0.010   32.707    0.000
   .DISCLIM           0.080    2.349    0.034    0.973
   .z_pv_overall      0.876    0.051   17.139    0.000
    lvw               2.070    0.205   10.116    0.000
    lve               0.068    0.008    8.537    0.000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a><span class="co"># The chi-square is 0 suggesting poor model fit - but the chi square test statistic has come down</span></span>
<span id="cb70-2"><a href="#cb70-2"></a><span class="co"># from 201.830 to 27.209 showing improvement</span></span>
<span id="cb70-3"><a href="#cb70-3"></a><span class="co"># The CFI is now  0.977 a better fit than the 0.806 - now into good fit</span></span>
<span id="cb70-4"><a href="#cb70-4"></a><span class="co"># The TLI has risen to 0.913 (was 0.585) - it is now good!</span></span>
<span id="cb70-5"><a href="#cb70-5"></a><span class="co"># The RMSEA has fallen from 0.089 to 0.040 showing an improvement and just gets under the 0.06 cut off</span></span>
<span id="cb70-6"><a href="#cb70-6"></a><span class="co"># for good fit</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="further-information" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="further-information"><span class="header-section-number">1.7</span> Further information</h2>
<ul>
<li>A good introduction to the <code>lavaan</code> package, which will support your understanding of SEM in R, can be found here <a href="https://lavaan.ugent.be/tutorial/">lavaan</a></li>
<li>You may find Schumacker and Lomax’s <span class="citation" data-cites="schumacker2004beginner">(<a href="#ref-schumacker2004beginner" role="doc-biblioref">Schumacker and Lomax 2004</a>)</span> book, <em>A beginner’s guide to structural equation modeling</em>, a helpful introduction.</li>
</ul>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-chin1998partial" class="csl-entry" role="listitem">
Chin, Wynne W. 1998. <span>“The Partial Least Squares Approach to Structural Equation Modeling.”</span> <em>Modern Methods for Business Research/Lawrence Erlbaum Associates</em>.
</div>
<div id="ref-fornell1981evaluating" class="csl-entry" role="listitem">
Fornell, Claes, and David F Larcker. 1981. <span>“Evaluating Structural Equation Models with Unobservable Variables and Measurement Error.”</span> <em>Journal of Marketing Research</em> 18 (1): 39–50.
</div>
<div id="ref-hair2021partial" class="csl-entry" role="listitem">
Hair Jr, Joseph F, G Tomas M Hult, Christian M Ringle, Marko Sarstedt, Nicholas P Danks, and Soumya Ray. 2021. <em>Partial Least Squares Structural Equation Modeling (PLS-SEM) Using r: A Workbook</em>. Springer Nature.
</div>
<div id="ref-hoyle2012handbook" class="csl-entry" role="listitem">
Hoyle, Rick H. 2012. <em>Handbook of Structural Equation Modeling</em>. Guilford press.
</div>
<div id="ref-hulland1999use" class="csl-entry" role="listitem">
Hulland, John. 1999. <span>“Use of Partial Least Squares (PLS) in Strategic Management Research: A Review of Four Recent Studies.”</span> <em>Strategic Management Journal</em> 20 (2): 195–204.
</div>
<div id="ref-lomax2013introduction" class="csl-entry" role="listitem">
Lomax, Richard. 2013. <span>“Introduction to Structural Equation Modeling.”</span> <em>Applied Quantitative Analysis in Education and the Social Sciences</em>, 245–64.
</div>
<div id="ref-schumacker2004beginner" class="csl-entry" role="listitem">
Schumacker, Randall E, and Richard G Lomax. 2004. <em>A Beginner’s Guide to Structural Equation Modeling</em>. psychology press.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>